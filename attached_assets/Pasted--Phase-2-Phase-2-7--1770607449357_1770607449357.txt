[Phase 2 검토 후 보완 요청]
Phase 2 작업 결과를 외부에서 검토했습니다. 아래 7가지를 확인하고 필요시 수정해 주세요.
작업 진행 상황 설명과 작업 결과는 항상 한글로 보여주세요.

⚠️ 기존 기능에 영향을 주지 않도록 주의하세요.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[확인 1] productRegistrations 변수 섀도잉 문제

작업 로그에서 routes.ts의 import 레벨 productRegistrations와
로컬 변수 productRegistrations(라인 3764 부근)가 섀도잉되는 것이 확인되었습니다.

현재는 스코프가 달라서 동작할 수 있지만, 향후 유지보수 시 혼란을 줄 수 있습니다.
import한 테이블 이름을 별칭(alias)으로 변경하거나,
로컬 변수명을 변경해서 섀도잉을 해소해 주세요.

예시:
import { productRegistrations as productRegistrationsTable } from './shared/schema';

또는 allocation 관련 코드에서 사용하는 변수명을 변경해 주세요.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[확인 2] 집계 API의 UPSERT 동작 확인

POST /api/admin/allocations/generate API에서
같은 날짜+상품코드로 재실행했을 때 UPSERT(수량 업데이트)가 되는지 확인해 주세요.

테스트 방법:
1. 특정 날짜로 집계 실행 → order_allocations에 레코드 생성
2. 같은 날짜로 다시 실행 → 기존 레코드의 totalQuantity가 업데이트되는지?
3. UNIQUE 제약조건 위반 에러가 발생하지 않는지?

만약 UPSERT가 아니라 중복 에러가 발생한다면,
Drizzle의 onConflictDoUpdate를 사용하여 수정해 주세요.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[확인 3] 주문 배정 시 수량 매칭 로직 검증

POST /api/admin/allocations/:allocationId/assign-orders에서
주문을 업체별 allocatedQuantity에 맞게 배정하는 로직을 확인해 주세요.

시나리오:
- A업체 allocatedQuantity: 80
- B업체 allocatedQuantity: 50
- 주문 목록: 주문1(30), 주문2(50), 주문3(40), 주문4(10), 주문5(20)

예상 결과:
- 주문1(30) + 주문2(50) → A업체 (누계 80) ✓
- 주문3(40) + 주문4(10) → B업체 (누계 50) ✓
- 주문5(20) → 미배정 또는 자체발송

확인 포인트:
a) 주문 수량 합계가 업체 allocatedQuantity를 초과하지 않는지?
b) 주문 하나가 업체 잔여 수량보다 클 때 어떻게 처리되는지?
   (예: A업체 잔여 30인데 주문이 50인 경우 → 다음 업체로 넘기는지?)
c) 모든 주문이 배정되지 못한 경우 미배정 주문은 어떻게 표시되는지?

문제가 있다면 수정해 주세요.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[확인 4] 배분 확정 시 selfQuantity 처리

POST /api/admin/allocations/:allocationId/confirm에서
selfQuantity > 0일 때 처리를 확인해 주세요.

- vendorId = NULL인 allocation_detail이 생성되는지?
- allocatedQuantity = selfQuantity로 설정되는지?
- status = 'confirmed'인지?
- 이후 주문 배정 시 selfQuantity 해당분은 fulfillmentType='self'로 배정되는지?

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[확인 5] 알림톡 vs SMS 확인

작업 로그에서 Solapi의 sendSMS 메서드가 없어서 SMS fallback을 사용한 것으로 보입니다.

현재 사이트에서는 sendBrandTalkDirect (알림톡)을 사용하고 있습니다.
배분 알림도 가능하면 알림톡(sendBrandTalkDirect)을 사용하는 것이 좋습니다.

확인 사항:
a) 현재 배분 알림이 SMS로 발송되는지, 알림톡으로 발송되는지?
b) sendBrandTalkDirect가 사용 가능하다면, 배분 알림도 알림톡으로 변경해 주세요.
c) 알림톡 템플릿이 필요한 경우, 일단 SMS로 유지하되 주석으로 표시해 주세요:
   // TODO: 알림톡 템플릿 등록 후 sendBrandTalkDirect로 변경 필요

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[확인 6] 배분 페이지 접근 경로 및 메뉴 등록

관리자 배분 페이지(/admin/orders/allocations)가:
a) 사이드바 메뉴에 정상 등록되었는지?
b) 메뉴 위치가 적절한지? (주문관리 하위 또는 별도 메뉴)
c) 페이지 로드 시 에러 없이 정상 렌더링되는지?

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[확인 7] 배분 확정 후 기존 주문 프로세스 연동 확인

배분 확정 → 주문 배정 후에 기존 주문 프로세스가 정상 동작하는지 확인해 주세요.

a) 외주 배정된 주문(fulfillmentType='vendor')이 주문 목록에서
   발송구분 "외주", 공급업체명이 정상 표시되는지?
b) 자체 배정된 주문(fulfillmentType='self')이 기존과 동일하게 동작하는지?
c) 외주 주문 → 배송중 전환 시 재고 미차감 (Phase 1-6 로직 동작)?
d) 자체 주문 → 배송중 전환 시 재고 차감 (Phase 1-6 로직 동작)?
e) 회원 정산(배송중 전환 시 자동 정산)이 외주/자체 구분 없이 동일하게 처리되는지?

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[결과 보고]
각 확인 항목별로 현재 상태와 수정 여부를 한글로 보고해 주세요:
- 확인 1: [현재 상태] → [수정 필요 여부]
- 확인 2: [현재 상태] → [수정 필요 여부]
- 확인 3: [현재 상태] → [수정 필요 여부]
- 확인 4: [현재 상태] → [수정 필요 여부]
- 확인 5: [현재 상태] → [수정 필요 여부]
- 확인 6: [현재 상태] → [수정 필요 여부]
- 확인 7: [현재 상태] → [수정 필요 여부]