# 작업 지시서: 주문 데이터 당일 기준 필터링 구현

## 📋 작업 개요
현재 주문 관련 모든 페이지와 현황판(대시보드)에서 데이터가 날짜 제한 없이 전체 표시되고 있습니다.
**모든 주문 데이터의 기본 조회 범위를 "오늘(당일)"로 변경**하고, 사용자가 기간 필터를 선택하면 해당 기간의 데이터를 조회할 수 있도록 구현해주세요.

---

## 🎯 변경 대상 (총 2개 영역)

### 영역 1: 관리자 & 회원 대시보드 현황판
현재 상태: 전체 주문 건수가 각 단계(대기/상품준비중/배송준비중/배송중 등)에 누적 표시됨
변경 목표: **당일 기준** 건수만 표시 + 기간 선택 시 해당 기간 건수 표시

**관리자 대시보드** (`/admin`)
- 주문 현황 요약 카드(대기, 상품준비중, 배송준비중, 배송중, 취소 등 각 단계별 건수)
- 기본값: 오늘 날짜 기준

**회원 대시보드** (`/dashboard`)
- 주문 현황 요약(각 단계별 건수)
- 기본값: 오늘 날짜 기준

**현황판 기간 필터 UI:**
- 대시보드 현황판 상단에 기간 선택 옵션 추가
- 빠른 선택 버튼: `오늘(기본)` | `이번 주` | `이번 달` | `직접 선택`
- 직접 선택 시: 시작일 ~ 종료일 날짜 피커(date picker) 표시
- 기간 변경 시 현황판의 모든 수치가 해당 기간 기준으로 갱신

---

### 영역 2: 주문 관련 테이블 페이지 (관리자 8개 + 회원 관련 탭)

**관리자 주문 페이지 (8개):**
1. `/admin/orders/pending` - 주문 대기
2. `/admin/orders/admin-cancel` - 주문조정(직권취소)
3. `/admin/orders/preparing` - 상품준비중
4. `/admin/orders/print-waybill` - 운송장 출력
5. `/admin/orders/ready-to-ship` - 배송준비중
6. `/admin/orders/cancelled` - 취소건 관리
7. `/admin/orders/shipping` - 배송중
8. `/admin/orders/completed` - 배송완료

**회원 대시보드 주문 관련 탭:**
- 주문조정 (order-adjust.tsx)
- 운송장조회 (order-invoice.tsx)
- 취소신청 (order-cancel.tsx)
- 주문내역 (order-list.tsx)

---

## 🔧 구현 상세

### 1. 백엔드 (API) 변경

**모든 주문 조회 API에 날짜 필터 파라미터 추가:**

```
GET /api/admin/orders/pending?startDate=2026-02-07&endDate=2026-02-07
GET /api/admin/orders/preparing?startDate=2026-02-07&endDate=2026-02-07
... (모든 주문 관련 API 동일)
```

- `startDate`, `endDate` 쿼리 파라미터 추가
- **파라미터가 없으면 기본값은 오늘 날짜** (서버 사이드에서 기본값 처리)
- 날짜 기준 필드: `pending_orders` 테이블의 `created_at` (주문 생성일) 사용
- 날짜 범위: startDate 00:00:00 ~ endDate 23:59:59 (한국 시간 KST 기준)

**대시보드 현황판 API도 동일하게 날짜 필터 적용:**

```
GET /api/admin/dashboard/summary?startDate=2026-02-07&endDate=2026-02-07
GET /api/member/dashboard/summary?startDate=2026-02-07&endDate=2026-02-07
```

**중요 - 시간대 처리:**
- 한국 시간(KST, UTC+9) 기준으로 "오늘"을 계산
- 서버에서 날짜 필터 적용 시 KST 기준 해당 날짜의 시작(00:00:00)과 끝(23:59:59)을 사용

### 2. 프론트엔드 변경

**2-1. 기간 필터 컴포넌트 생성**

공통으로 사용할 `DateRangeFilter` 컴포넌트를 만들어주세요:

```
컴포넌트 위치: client/src/components/common/DateRangeFilter.tsx

기능:
- 빠른 선택 버튼: 오늘(기본) | 어제 | 이번 주 | 이번 달 | 직접 선택
- 직접 선택 시: 시작일, 종료일 date picker 표시
- 선택된 기간이 변경되면 onDateChange(startDate, endDate) 콜백 호출
- 현재 선택된 기간을 시각적으로 표시 (예: "2026.02.07 (오늘)")
- UI: shadcn/ui의 Button, Calendar, Popover 컴포넌트 활용
```

**2-2. 관리자 주문 페이지에 적용**

기존 `AdminCategoryFilter` 컴포넌트와 함께 `DateRangeFilter`를 배치:
- 필터 영역 상단에 날짜 필터 배치
- 기본값: 오늘
- 날짜 변경 시 해당 페이지의 주문 데이터 API를 새 날짜 범위로 재조회

**2-3. 회원 주문 탭에 적용**

기존 `MemberOrderFilter` 컴포넌트에 날짜 필터가 이미 있다면 기본값만 "오늘"로 변경.
없다면 `DateRangeFilter` 추가.

**2-4. 대시보드 현황판에 적용**

관리자/회원 대시보드 현황판 상단에 `DateRangeFilter` 배치:
- 기간 변경 시 현황판 카드의 모든 수치 갱신

### 3. 기본값 동작 정리

| 페이지 | 기본 조회 범위 | 필터 변경 시 |
|--------|---------------|-------------|
| 관리자 대시보드 현황판 | 오늘 | 선택한 기간 |
| 관리자 주문 8개 페이지 | 오늘 | 선택한 기간 |
| 회원 대시보드 현황판 | 오늘 | 선택한 기간 |
| 회원 주문 관련 탭 | 오늘 | 선택한 기간 |

---

## ⚠️ 주의사항

1. **기존 필터와 병행**: 기존 AdminCategoryFilter(상호명, 카테고리, 키워드)와 MemberOrderFilter는 그대로 유지. 날짜 필터는 추가로 적용되는 것 (AND 조건)
2. **TanStack Query 캐시**: 날짜 파라미터를 queryKey에 포함하여 날짜 변경 시 자동으로 새 데이터 조회
3. **성능**: 날짜 인덱스가 `pending_orders.created_at`과 `orders.created_at`에 있는지 확인. 없으면 인덱스 추가
4. **배송완료 페이지**: `orders` 테이블(아카이브)도 동일하게 날짜 필터 적용
5. **SSE 실시간 갱신**: 실시간 이벤트 수신 시 현재 필터 기간 내의 데이터만 갱신되도록 처리
6. **주문내역 탭(order-list.tsx)**: 회원의 전체 주문 이력을 보는 페이지이므로, 기본값은 "오늘"이지만 "전체" 옵션도 빠른 선택에 추가

---

## ✅ 완료 기준
- [ ] 모든 주문 페이지 접속 시 당일 데이터만 표시됨
- [ ] 관리자/회원 대시보드 현황판이 당일 기준 수치 표시
- [ ] 기간 필터(오늘/어제/이번주/이번달/직접선택) 정상 작동
- [ ] 기간 변경 시 테이블 데이터와 현황판 수치 모두 갱신
- [ ] 기존 카테고리/키워드 필터와 날짜 필터 동시 사용 가능
- [ ] 한국 시간(KST) 기준으로 정확한 날짜 계산
