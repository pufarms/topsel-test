아래 5가지 문제를 모두 수정해줘. 매우 중요한 수정이니 꼼꼼하게 처리해야 해.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
문제 1: 회원 페이지에서 API Key 저장 안 됨 (치명적 버그)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- 관리자 페이지(관리자 대시보드)에서는 API Key 입력/저장/다음단계 정상 작동
- 회원 페이지(마이페이지)에서는 API Key 입력 후 저장 안 되고 다음 단계로 안 넘어감

원인 추정:
- 회원 마이페이지에서 AI Studio 컴포넌트가 사용하는 API 엔드포인트 경로가 
  관리자 대시보드와 다를 수 있음
- 또는 회원의 세션/인증이 ai-studio API에서 인식되지 않을 수 있음
- 또는 회원 마이페이지의 라우팅 구조가 달라서 API 호출이 실패할 수 있음

수정 사항:
1. 관리자 대시보드와 회원 마이페이지에서 완전히 동일한 AIStudioApp 컴포넌트 사용 확인
2. 두 곳 모두에서 /api/ai-studio/* 엔드포인트에 정상 접근되는지 확인
3. 회원 세션에서도 requireAuth 미들웨어가 정상 작동하는지 확인
4. 브라우저 콘솔에서 회원 페이지 접근 시 네트워크 오류가 있는지 확인
5. 관리자용 미들웨어(isAdmin 체크)가 ai-studio 라우트에 걸려있지 않은지 확인

반드시 회원 계정으로 로그인해서 테스트하고, 
API Key 저장 → 다음 단계 → 제품 정보 입력 → 생성까지 전체 플로우가 
관리자와 동일하게 작동하는지 확인해줘.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
문제 2: 카피 생성 오류 수정
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- 스크린샷을 보면 5명 카피라이터 영역에 모두 "생성 오류 - 다시 시도해주세요" 표시
- 이미지는 생성되었지만 카피가 생성 실패

수정 사항:
1. 서버 로그에서 카피 생성 API 호출 시 어떤 에러가 나는지 확인
2. Gemini API 응답 파싱 로직 확인 — JSON 파싱 실패 가능성
3. 카피 생성 프롬프트가 너무 복잡하면 단순화
4. 에러 발생 시 자동 재시도 로직 추가 (최대 2회)
5. API 응답이 예상 JSON 형식이 아닐 때의 fallback 처리 추가
6. 실제 API Key로 카피 생성이 되는지 테스트

카피 생성 서버 로직(ai-studio-routes.ts)에서 
try-catch로 에러를 잡고 구체적인 에러 메시지를 클라이언트에 전달하도록 수정.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
문제 3: 이미지 다양화 — 여러 장 업로드 + 섹션별 다른 이미지
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- 사진 1장만 업로드 가능 → 8개 섹션 모두 동일한 제품 이미지 기반
- 결과물이 너무 단조로움

변경 요구사항:
1. 이미지 업로드를 여러 장 가능하도록 변경 (최소 1장, 최대 8장)
2. 업로드 UI 변경:
   - 기존 단일 업로더 → 멀티 업로더
   - 업로드된 이미지 썸네일 리스트 표시 (가로 스크롤)
   - 각 이미지 삭제 가능 (X 버튼)
   - "추가 업로드" 버튼으로 이미지 계속 추가 가능
   - 안내 문구: "사진을 1~8장 올려주세요. 다양한 사진을 올리면 더 풍성한 상세페이지가 만들어집니다."

3. 섹션별 이미지 배정 로직:
   - 이미지 1장만 올린 경우: 기존처럼 모든 섹션에 같은 이미지 사용
   - 여러 장 올린 경우: AI가 섹션 성격에 맞는 이미지를 자동 배정
     예시:
     · 히어로 → 가장 예쁜/대표 이미지
     · 맛/품질 → 단면/과즙이 보이는 이미지
     · 산지 스토리 → 과수원/농부 이미지
     · 배송/보관 → 포장 이미지
   - 사용자가 수동으로 섹션별 이미지를 변경할 수도 있으면 좋음
     (에디터에서 "이미지 변경" 버튼)

4. 데이터 구조 변경:
   - ProductInfo에 images: string[] (base64 배열) 추가
   - 기존 imageBase64: string 유지 (대표 이미지, 하위 호환)
   - generateAllSections에 images 배열 전달

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
문제 4: 섹션별 서브카피(설명문) 추가 생성
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- 모든 섹션이 메인 카피 1줄만 생성
- 실제 상세페이지에서는 메인 카피 + 설명문(서브카피)이 함께 구성됨

변경 요구사항:
1. 히어로 섹션: 메인 카피 1줄만 (현재 유지)
2. 나머지 7개 섹션: 메인 카피 1줄 + 서브카피(설명문) 1~2줄 함께 생성

서브카피 성격 (섹션별):
- 문제공감: 공감 상황 묘사 (예: "마트에서 고른 과일, 집에 오면 실망한 적 있으시죠?")
- 사회적 증거: 구체적 수치/실적 (예: "지난 시즌 판매 2만 박스, 재주문율 87%")
- 맛/품질: 맛 특징 설명 (예: "당도 16Brix, 아삭한 식감과 풍부한 과즙의 조화")
- 구성/스펙: 구성 상세 (예: "3kg / 9~11과 / 특대 사이즈 / 개별 완충 포장")
- 산지 스토리: 산지/생산자 소개 (예: "충주 30년 명인 김영동 농부의 정성")
- 배송/보관: 배송 안내 (예: "수확 후 24시간 이내 출고, 아이스팩 신선 배송")
- 최종 CTA: 혜택/프로모션 요약 (예: "지금 주문 시 3박스 이상 10% 할인")

3. AI 프롬프트에 서브카피 요청 추가:
   각 카피라이터가 응답할 때:
   {
     "style": "Donald Miller",
     "mainCopy": "메인 카피 25자 이내",
     "subCopy": "서브카피 설명문 40~60자"
   }

4. 에디터에서 서브카피도 별도 텍스트 레이어로 추가:
   - 메인 카피: 큰 폰트, 상단 또는 중앙
   - 서브카피: 작은 폰트, 메인 카피 아래
   - 서브카피도 크기/색상/위치 편집 가능
   - 사용자가 서브카피를 안 쓰고 싶으면 삭제 가능

5. 히어로 섹션은 서브카피 없이 메인 카피만 (현재 방식 유지)

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
문제 5: 섹션별 카피 목적을 세밀하게 구분 (가장 중요!)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- 모든 섹션에서 카피가 비슷한 톤으로 나옴
- "문제공감" 섹션인데 메인 카피처럼 나오고
- "사회적 증거" 섹션인데도 그냥 일반 카피처럼 나옴
- 각 섹션의 고유한 목적이 카피에 반영되지 않음

원인:
- AI에게 보내는 프롬프트에서 섹션별 목적이 충분히 구체적이지 않음
- 단순히 "이 섹션의 목적: ~" 한 줄만으로는 AI가 구분하지 못함

수정 사항:
서버의 카피 생성 프롬프트를 섹션별로 완전히 다르게 작성해줘.
아래 내용을 각 섹션의 프롬프트에 정확히 반영:

[섹션 1: 히어로 메인]
목적: 3초 안에 스크롤을 멈추게 하는 강렬한 첫인상
톤: 감탄사, 짧고 강렬한 Hook
금지: 설명적 문장, 기능 나열
예시 방향: "이 사과, 한 입에 반합니다" / "올 가을의 맛, 여기 있습니다"
메인 카피만 (서브카피 없음)

[섹션 2: 문제 공감]
목적: 고객의 과일 구매 실패 경험에 공감하여 "맞아!" 반응 유도
톤: 공감, 질문, 아쉬움
금지: 제품 자랑, 긍정적 표현
반드시 포함: 구매 실패 상황 언급 (맛없는 과일, 실망, 속음)
메인 카피 예시: "또 맛없는 과일에 속으셨나요?"
서브 카피 예시: "마트에서 예뻐 보여 골랐는데 집에 오면 실망, 한두 번이 아니시죠?"

[섹션 3: 사회적 증거]
목적: 이 과일이 이미 많은 사람에게 검증되었다는 신뢰 구축
톤: 자신감, 팩트, 숫자
금지: 감성적 표현, 추상적 표현
반드시 포함: 구체적 숫자 (판매량, 재주문율, 리뷰 수, 별점 등)
메인 카피 예시: "재주문율 87%, 이유가 있습니다"
서브 카피 예시: "지난 시즌 판매 2만 박스, 고객 별점 4.9점의 검증된 맛"

[섹션 4: 맛/품질 강조]
목적: 이 과일의 맛이 왜 특별한지 구체적으로 설득
톤: 감각적(시각, 미각, 촉각), 구체적
금지: 추상적 "맛있다", 일반적 표현
반드시 포함: 당도, 식감, 과즙 등 구체적 맛 표현
메인 카피 예시: "한 입 베어물면, 과즙이 터집니다"
서브 카피 예시: "당도 16.5Brix, 아삭한 식감에 새콤달콤 과즙이 입안 가득"

[섹션 5: 구성/스펙]
목적: 구매 시 정확히 무엇을 받는지 명확하게 안내
톤: 명확, 정리, 안심
금지: 감성적 표현, 과장
반드시 포함: 수량, 중량, 사이즈, 포장 방식
메인 카피 예시: "받으실 구성을 확인하세요"
서브 카피 예시: "3kg / 특대 9~11과 / 개별 완충 포장 / 선물용 박스"

[섹션 6: 산지 스토리]
목적: 산지와 생산자에 대한 감성적 신뢰와 연결
톤: 따뜻함, 정성, 전통, 스토리텔링
금지: 차가운 팩트 나열, 광고 느낌
반드시 포함: 산지명, 생산자 경력, 재배 철학
메인 카피 예시: "30년 명인의 과수원에서 왔습니다"
서브 카피 예시: "충주 수안보의 김영동 농부, 매년 첫 수확 과일만 엄선합니다"

[섹션 7: 배송/보관]
목적: 신선식품 배송에 대한 걱정을 해소하고 안심시킴
톤: 안심, 꼼꼼함, 신뢰
금지: 제품 맛 설명, 구매 압박
반드시 포함: 배송 방법, 포장 상태, 보관법
메인 카피 예시: "수확 후 24시간, 신선하게 도착합니다"
서브 카피 예시: "아이스팩 + 완충재 + 냉장 배송, 문 앞까지 신선함 그대로"

[섹션 8: 최종 CTA]
목적: 마지막 구매 결정을 이끌어내는 행동 촉구
톤: 긴박감, 혜택 강조, 행동 유도
금지: 정보 전달, 설명
반드시 포함: 한정 혜택, 지금 사야 하는 이유
메인 카피 예시: "지금이 아니면 1년을 기다려야 합니다"
서브 카피 예시: "올해 첫 수확 한정 물량, 3박스 이상 주문 시 10% 즉시 할인"

위 내용을 서버의 카피 생성 프롬프트에 정확히 반영해줘.
각 섹션의 프롬프트가 완전히 다르게 구성되어야 하며,
"목적/톤/금지/반드시 포함/예시" 모두 AI에게 전달되어야 해.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
문제 6: 8개 섹션 비주얼 통일감 부여 (2단계 생성 구조)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

현재 상태:
- 8개 섹션의 배경이 너무 상이하고 상반됨
- 같은 상품인데 섹션마다 완전히 다른 느낌 → 이질감
- 통일감 없이 고객의 집중도와 관심이 떨어짐

해결 방법: "2단계 생성" 구조로 변경

[Step 1] 전체 비주얼 기조 설계 (아트 디렉션)
- 8개 섹션 이미지를 만들기 전에 AI에게 먼저 전체 기조를 물어봄
- 제품 정보 + 대표 이미지를 주고 전체 비주얼 방향을 설계하게 함
- 이 단계는 gemini-3-flash-preview로 텍스트만 생성 (이미지 X)
- 1회 호출로 완료

프롬프트:
"당신은 과일 상세페이지 전문 아트 디렉터입니다.
이 상품의 상세페이지 이미지 8장 세트를 만들 예정입니다.
8장이 하나의 상세페이지로서 통일감 있게 보이도록
전체 비주얼 기조를 먼저 설계해주세요.

상품 정보:
- 과일: {fruitType}
- 산지: {origin}
- 특징: {features}

아래 항목을 JSON으로 응답해주세요:
{
  "colorTone": "전체 색감 톤 (예: warm golden with soft green accents)",
  "lightingStyle": "조명 스타일 (예: natural warm sunlight, golden hour)",
  "mood": "전체 분위기 (예: premium yet approachable countryside freshness)",
  "productPlacement": "상품 배치 기조 (예: product centered, 40-60% of frame)",
  "commonElements": "공통 소품/질감 (예: wooden texture, morning dew, linen)",
  "backgroundBase": "기본 배경 방향 (예: soft cream/beige natural tones)"
}

주의사항:
- 과일의 색감과 어울리는 톤을 선택
- 산지의 느낌을 반영 (한국 시골, 과수원, 자연)
- 8장 전체가 한 세트로 느껴지는 통일감이 핵심
- 너무 화려하지 않고, 상품이 돋보이는 깔끔한 방향"

[Step 2] 섹션별 이미지 생성 (기존 8회 호출 유지)
- 각 섹션의 이미지 프롬프트 앞에 Step 1의 기조를 공통으로 삽입
- 기존 섹션별 프롬프트는 "변주" 역할로 유지

프롬프트 구조:
"[전체 비주얼 기조 — 모든 섹션 공통]
Overall art direction for this product detail page set:
Color tone: {Step1.colorTone}
Lighting: {Step1.lightingStyle}
Mood: {Step1.mood}
Product placement: {Step1.productPlacement}
Common elements: {Step1.commonElements}
Background base: {Step1.backgroundBase}

IMPORTANT: Maintain visual consistency with the above art direction
while adding the section-specific variation below.

[이 섹션의 변주]
Section: {sectionName}
Additional background variation: {기존 섹션별 이미지 프롬프트}

Keep the product in the foreground exactly as is.
Professional advertising photography, photorealistic, high quality, 4k,
spacious composition, clean layout."

구현 사항:
1. 새로운 함수 추가: generateArtDirection(apiKey, productInfo, imageBase64)
   - gemini-3-flash-preview 호출
   - JSON 응답으로 전체 기조 반환
   - 실패 시 기본 기조 사용 (fallback)

2. generateAllSections 흐름 변경:
   기존: 바로 8개 섹션 순차 생성
   변경:
   ① generateArtDirection() 호출 → 전체 기조 받기 (진행률: "비주얼 기조 설계 중...")
   ② 받은 기조를 각 섹션 이미지 프롬프트에 공통 삽입
   ③ 8개 섹션 순차 생성 (기존과 동일)

3. GeneratingProgress UI 업데이트:
   - 기존: "섹션 1/8 생성 중..."
   - 변경: "비주얼 기조 설계 중... (0/8)" → "섹션 1/8 생성 중..."
   - Step 1 완료 시 "✅ 비주얼 기조 설계 완료 — [톤 요약]" 표시

4. fallback 기조 (API 실패 시):
   {
     "colorTone": "warm natural tones with product-complementary accents",
     "lightingStyle": "soft natural daylight, clean studio feel",
     "mood": "premium yet approachable, clean and fresh",
     "productPlacement": "product centered, occupying 40-50% of frame",
     "commonElements": "clean white/cream surface, subtle shadows",
     "backgroundBase": "soft gradient from white to light warm gray"
   }

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

위 6가지를 모두 수정 완료 후:
1. 관리자 + 회원 양쪽에서 API Key 저장 → 전체 플로우 테스트
2. 카피가 섹션별로 다른 톤/목적으로 생성되는지 확인
3. 8개 섹션 이미지가 통일감 있게 나오는지 확인
4. 수정 결과를 보고해줘