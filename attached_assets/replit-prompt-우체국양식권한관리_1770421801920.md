# 작업 지시서: 회원별 우체국 양식 사용 권한 관리 기능

## 📋 작업 개요
현재 모든 회원이 주문 등록(업로드) 및 운송장 파일 다운로드 시 "기본양식"과 "우체국 양식" 두 가지를 모두 사용할 수 있습니다.
**우체국 양식은 관리자가 특정 회원에게만 허용**하고, 권한이 없는 회원에게는 우체국 관련 옵션이 아예 보이지 않도록 변경합니다.

---

## 🎯 변경 내용 (3개 영역)

### 영역 1: 데이터베이스 - 회원 테이블에 우체국 권한 필드 추가

**`members` 테이블에 새 컬럼 추가:**

| 컬럼명 | 타입 | 기본값 | 설명 |
|--------|------|--------|------|
| `post_office_enabled` | boolean | `false` | 우체국 양식 사용 권한 여부 |

- 기본값 `false` → 모든 기존 회원은 기본양식만 사용
- 관리자가 `true`로 변경한 회원만 우체국 양식 사용 가능

---

### 영역 2: 관리자 회원관리 페이지 (`/admin/users`) 수정

**2-1. 회원 목록 테이블에 우체국 권한 표시**

현재 회원 목록 테이블 컬럼:
`상호명 | 아이디 | 회원명 | 등급 | 대표자 | 대표연락처 | 이메일 | 예치금 | 포인트 | 상태 | 가입일 | 관리`

수정 후 - "상태" 컬럼 옆(또는 적절한 위치)에 **"우체국"** 컬럼 추가:
`... | 포인트 | 상태 | 우체국 | 가입일 | 관리`

- 우체국 권한 있는 회원: 활성화 표시 (예: 초록색 뱃지 "사용" 또는 체크 아이콘)
- 우체국 권한 없는 회원: 비활성 표시 (예: 회색 뱃지 "미사용" 또는 빈칸)

**2-2. 회원 상세/수정 화면에서 우체국 권한 토글**

회원 상세 정보 수정 화면에 **"우체국 양식 사용"** 토글(스위치) 추가:
- ON/OFF 스위치로 간편하게 권한 변경
- 변경 즉시 저장 (또는 저장 버튼과 함께)

**2-3. 일괄 수정 기능에 우체국 권한 추가**

현재 "일괄 수정" 섹션(체크한 회원에게 적용)에 우체국 권한 일괄 변경 옵션 추가:
- 체크된 회원들에게 우체국 양식 사용 권한 일괄 부여/해제 가능

**2-4. 검색 및 필터에 우체국 필터 추가**

현재 검색 필터 영역:
`상호명 | 아이디 | 등급 | 정렬`

수정 후 - **"우체국"** 필터 드롭다운 추가:
`상호명 | 아이디 | 등급 | 우체국 | 정렬`

우체국 필터 옵션:
- `전체` (기본값)
- `사용` (post_office_enabled = true인 회원만)
- `미사용` (post_office_enabled = false인 회원만)

**2-5. 회원 현황 카드에 우체국 회원 수 표시 (선택사항)**

현재 상단 현황 카드:
`전체 회원 | 보류중 | 준회원 | Start회원 | Driving회원 | Top회원`

이 카드 영역에 또는 별도로 **"우체국 사용 회원: N명"** 표시 추가 고려
(필수 사항은 아니지만 있으면 관리 편의성 향상)

---

### 영역 3: 회원 대시보드 - 우체국 양식 조건부 노출

**3-1. 주문 등록 (업로드)**

회원이 주문 등록(엑셀 업로드) 시:
- `post_office_enabled = true`인 회원: "기본양식"과 "우체국 양식" 둘 다 표시
- `post_office_enabled = false`인 회원: **"기본양식"만 표시** (우체국 양식 옵션 자체가 보이지 않음)

**3-2. 운송장 파일 다운로드**

회원이 운송장 파일 다운로드 시:
- `post_office_enabled = true`인 회원: "기본양식 다운로드"와 "우체국 양식 다운로드" 둘 다 표시
- `post_office_enabled = false`인 회원: **"기본양식 다운로드"만 표시** (우체국 양식 다운로드 버튼/옵션 자체가 보이지 않음)

**3-3. 권한 정보 전달 방식**

회원 로그인 시 또는 API 응답에 `post_office_enabled` 값을 포함하여 프론트엔드에서 조건부 렌더링:
```
// 예시: 회원 정보 API 응답에 포함
{
  "id": 1,
  "businessName": "탑셀01",
  "grade": "ASSOCIATE",
  "post_office_enabled": false,  // ← 이 값으로 UI 조건 분기
  ...
}
```

프론트엔드에서는 이 값을 기반으로:
```jsx
{member.post_office_enabled && (
  <Button>우체국 양식 다운로드</Button>
)}
```

---

## 🔧 API 변경 사항

**1. 회원 정보 조회 API - post_office_enabled 필드 포함**
```
GET /api/member/profile → 응답에 post_office_enabled 포함
GET /api/admin/users → 목록에 post_office_enabled 포함
GET /api/admin/users/:id → 상세에 post_office_enabled 포함
```

**2. 회원 수정 API - post_office_enabled 변경 가능**
```
PATCH /api/admin/users/:id → body에 post_office_enabled 포함 가능
```

**3. 일괄 수정 API - post_office_enabled 일괄 변경**
```
PATCH /api/admin/users/bulk → body에 post_office_enabled 포함 가능
```

**4. 회원 목록 필터 API - 우체국 필터 파라미터 추가**
```
GET /api/admin/users?postOffice=true → 우체국 사용 회원만
GET /api/admin/users?postOffice=false → 미사용 회원만
GET /api/admin/users → 전체 (기본)
```

---

## ⚠️ 주의사항

1. **보안**: 프론트엔드에서 우체국 옵션을 숨기는 것뿐만 아니라, **서버 API에서도 권한 체크** 필요. 우체국 양식 업로드/다운로드 API 호출 시 해당 회원의 `post_office_enabled`를 확인하여 권한 없으면 거부
2. **기존 회원 데이터**: 마이그레이션 시 모든 기존 회원의 `post_office_enabled`는 `false`로 설정
3. **Drizzle ORM 스키마**: `members` 테이블 스키마에 `postOfficeEnabled` 필드 추가 필요

---

## ✅ 완료 기준
- [ ] members 테이블에 post_office_enabled 컬럼 추가 (기본값 false)
- [ ] 관리자 회원관리: 목록에 우체국 권한 상태 표시
- [ ] 관리자 회원관리: 회원 상세에서 우체국 권한 ON/OFF 토글 가능
- [ ] 관리자 회원관리: 일괄 수정으로 우체국 권한 일괄 변경 가능
- [ ] 관리자 회원관리: 검색 필터에 우체국 필터 추가 (전체/사용/미사용)
- [ ] 회원 대시보드: 권한 없는 회원에게 우체국 양식 옵션이 보이지 않음
- [ ] 회원 대시보드: 권한 있는 회원에게 기본양식 + 우체국 양식 모두 표시
- [ ] 서버 API에서 우체국 양식 업로드/다운로드 시 권한 체크
