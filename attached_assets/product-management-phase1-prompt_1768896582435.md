# 상품관리 시스템 구현 요청 (1차)

## 📋 개요

탑셀러 B2B 과일 도매 플랫폼의 **상품관리 시스템**을 구현해주세요.
이번 1차에서는 **메뉴 구조 + 카테고리 관리 + 상품등록(공급가 계산)** 을 구현합니다.

---

## 🗂️ 상품관리 메뉴 구조

사이드바에 "상품관리" 메뉴를 추가하고, 아래 5개의 하위 메뉴를 생성해주세요.

```
상품관리
├── 카테고리 관리
├── 상품등록 (공급가 계산)    ← 1차 구현
├── 차주 예상공급가 상품      ← 2차 구현 예정
├── 현재 공급가 상품          ← 2차 구현 예정
└── 공급 중지 상품            ← 2차 구현 예정
```

**1차 구현 범위**: 카테고리 관리 + 상품등록 (공급가 계산)
**2차 구현 예정**: 차주 예상공급가 / 현재 공급가 / 공급 중지 (메뉴만 생성, 페이지는 "준비 중" 표시)

---

# 1️⃣ 카테고리 관리 페이지

## 기능 설명
- 상품의 **대분류 / 중분류 / 소분류** 3단계 카테고리를 관리
- 상품등록 시 카테고리 드롭다운에서 사용됨

## 카테고리 계층 구조
```
대분류 (예: 과일, 채소)
  └── 중분류 (예: 사과, 배, 복숭아)
        └── 소분류 (예: 부사, 홍로, 아오리)
```

## UI 구성

```
┌─────────────────────────────────────────────────────────────────┐
│ 카테고리 관리                                                    │
│ 상품의 대분류/중분류/소분류 카테고리를 관리합니다.                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ [대분류 탭] [중분류 탭] [소분류 탭]                               │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│ [+ 카테고리 추가]                              검색: [____] [검색]│
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ ■ 대분류 탭 선택 시                                              │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ □ │ 분류명  │ 등록일      │ 중분류 수 │ 상품 수 │ 관리       │ │
│ │ □ │ 과일   │ 2025-01-15 │ 5        │ 45     │ [수정][삭제]│ │
│ │ □ │ 채소   │ 2025-01-15 │ 3        │ 12     │ [수정][삭제]│ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ■ 중분류 탭 선택 시                                              │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 대분류 선택: [전체 ▼]                                        │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ □ │ 분류명  │ 상위분류 │ 등록일      │ 소분류 수│상품 수│관리 │ │
│ │ □ │ 사과   │ 과일    │ 2025-01-15 │ 4       │ 20   │[수정]│ │
│ │ □ │ 배    │ 과일    │ 2025-01-15 │ 2       │ 10   │[수정]│ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ■ 소분류 탭 선택 시                                              │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ 대분류 선택: [전체 ▼]  중분류 선택: [전체 ▼]                   │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │ □ │ 분류명 │ 대분류 │ 중분류 │ 등록일      │ 상품 수 │ 관리  │ │
│ │ □ │ 부사  │ 과일  │ 사과  │ 2025-01-15 │ 8      │ [수정]│ │
│ │ □ │ 홍로  │ 과일  │ 사과  │ 2025-01-15 │ 5      │ [수정]│ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 카테고리 추가 모달

```
┌─────────────────────────────────────┐
│ 카테고리 추가                        │
├─────────────────────────────────────┤
│                                     │
│ 분류 단계: ○ 대분류  ○ 중분류  ○ 소분류│
│                                     │
│ (중분류 선택 시)                      │
│ 상위 대분류: [과일 ▼]                 │
│                                     │
│ (소분류 선택 시)                      │
│ 상위 대분류: [과일 ▼]                 │
│ 상위 중분류: [사과 ▼]                 │
│                                     │
│ 분류명: [______________]             │
│                                     │
│              [취소] [추가]           │
└─────────────────────────────────────┘
```

## 데이터 스키마 (categories 테이블)

```typescript
{
  id: number;
  name: string;                              // 분류명
  level: 'large' | 'medium' | 'small';       // 대분류 / 중분류 / 소분류
  parentId: number | null;                   // 상위 분류 ID (대분류는 null)
  createdAt: Date;
  updatedAt: Date;
}
```

## API 엔드포인트

```
GET    /api/categories                 # 전체 목록 (level, parentId 필터 가능)
GET    /api/categories/:id             # 단일 조회
POST   /api/categories                 # 추가
PUT    /api/categories/:id             # 수정
DELETE /api/categories/:id             # 삭제
```

## 삭제 규칙
- **대분류 삭제 시**: 하위 중분류/소분류가 있으면 삭제 불가 (알림 표시)
- **중분류 삭제 시**: 하위 소분류가 있으면 삭제 불가
- **상품이 연결된 카테고리**: 삭제 불가 (알림: "해당 카테고리에 N개 상품이 있습니다")

---

# 2️⃣ 상품등록 (공급가 계산) 페이지

## 페이지 목적

1. **신규 상품 등록**: 엑셀 업로드 또는 직접 입력
2. **기존 상품 수정**: 검색 필터로 불러와서 수정
3. 원가, 부대비용, 마진율 입력 (개별 또는 일괄)
4. **등급별 공급가 자동 계산** (Start / Driving / Top)
5. 완성된 데이터를 "차주 예상공급가 상품"으로 전송

---

## 페이지 레이아웃

```
┌──────────────────────────────────────────────────────────────────────────┐
│ 상품등록 (공급가 계산)                                                    │
│ 상품 정보를 입력하고 공급가를 계산하여 차주 예상공급가로 전송합니다.         │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ ■ 섹션 1: 엑셀 업로드 (임시등록)                                          │
│ ┌──────────────────────────────────────────────────────────────────────┐│
│ │  📤 엑셀 파일을 드래그하거나 클릭하여 업로드하세요                      ││
│ │     [양식 다운로드]                                                   ││
│ │  * 업로드 시 기본정보(대분류~상품명)가 테이블에 추가됩니다.              ││
│ └──────────────────────────────────────────────────────────────────────┘│
│                                                                          │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ ■ 섹션 2: 기존 상품 검색 (수정용)                                         │
│ ┌──────────────────────────────────────────────────────────────────────┐│
│ │ 대분류: [전체▼] 중분류: [전체▼] 소분류: [전체▼]                        ││
│ │ 상품코드: [________] 상품명: [________] [검색] [초기화]                ││
│ └──────────────────────────────────────────────────────────────────────┘│
│                                                                          │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ ■ 섹션 3: 일괄 적용 (선택한 상품에 한꺼번에 값 적용)                       │
│ ┌──────────────────────────────────────────────────────────────────────┐│
│ │ [상품 원가]                                                           ││
│ │ 원상품 기준가: [      ]원  로스율: [    ]%  원상품 기준중량: [    ]kg   ││
│ │                                                                       ││
│ │ [부대비용]                                                            ││
│ │ 박스비:[    ] 자재비:[    ] 아웃박스:[    ] 보자기:[    ]              ││
│ │ 작업비:[    ] 택배비:[    ]                                           ││
│ │                                                                       ││
│ │ [등급별 마진율] (각 등급별로 다르게 입력 가능)                          ││
│ │ Start 마진율: [    ]%   Driving 마진율: [    ]%   Top 마진율: [    ]%  ││
│ │                                                                       ││
│ │                                    [✓ 선택한 상품에 일괄 적용]         ││
│ └──────────────────────────────────────────────────────────────────────┘│
│                                                                          │
├──────────────────────────────────────────────────────────────────────────┤
│ [+ 새 행 추가] [선택 삭제] [공급 중지 설정]                                │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│ ■ 섹션 4: 상품 테이블 (엑셀 기본 서식과 동일한 구조)                       │
│ ┌──────────────────────────────────────────────────────────────────────┐│
│ │ (아래 "테이블 컬럼 구조" 참조)                                         ││
│ │ - 노란색 컬럼: 자동계산 (수정 불가, 읽기 전용)                          ││
│ │ - 흰색 컬럼: 직접 입력 가능                                            ││
│ │ - 빈칸: 옅은 빨간색 배경으로 표시                                       ││
│ └──────────────────────────────────────────────────────────────────────┘│
│                                                                          │
├──────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│                              [차주 예상공급가 상품으로 전송]               │
│                                                                          │
└──────────────────────────────────────────────────────────────────────────┘
```

---

## 테이블 컬럼 구조 (엑셀 기본 서식 그대로)

### 전체 컬럼 (좌→우 순서)

| 순번 | 컬럼명 | 입력방식 | 설명 |
|------|--------|----------|------|
| 1 | **체크** | 체크박스 | 일괄 적용/삭제용 선택 |
| 2 | **대분류** | 드롭다운 필터 | 카테고리 (1개 이상 필수) |
| 3 | **중분류** | 드롭다운 필터 | 대분류 선택 시 활성화 |
| 4 | **소분류** | 드롭다운 필터 | 중분류 선택 시 활성화 |
| 5 | **중량(수량)** | 직접 입력 | 필수 |
| 6 | **상품코드** | 직접 입력 | 필수, 고유값 |
| 7 | **상품명** | 직접 입력 | 필수 |
| 8 | **원상품** | 직접 입력 | 선택 (재고관리 연계용) |
| 9 | **원상품 기준가** | 직접 입력 | 숫자 (원) |
| 10 | **로스율** | 직접 입력 | 숫자 (%) |
| 11 | **원상품 기준중량** | 직접 입력 | 숫자 (kg) |
| 12 | **개별단가** | 🟡 자동계산 | 수정 불가 |
| 13 | **박스비** | 직접 입력 | 숫자 (원), 기본값 0 |
| 14 | **자재비** | 직접 입력 | 숫자 (원), 기본값 0 |
| 15 | **아웃박스** | 직접 입력 | 숫자 (원), 기본값 0 |
| 16 | **보자기** | 직접 입력 | 숫자 (원), 기본값 0 |
| 17 | **작업비** | 직접 입력 | 숫자 (원), 기본값 0 |
| 18 | **택배비** | 직접 입력 | 숫자 (원), 기본값 0 |
| 19 | **상품 총원가** | 🟡 자동계산 | 수정 불가 |
| 20 | **Start 마진율** | 직접 입력 | 숫자 (%) |
| 21 | **Start 공급가** | 🟡 자동계산 | 수정 불가 |
| 22 | **Start 마진** | 🟡 자동계산 | 수정 불가 |
| 23 | **Driving 마진율** | 직접 입력 | 숫자 (%) |
| 24 | **Driving 공급가** | 🟡 자동계산 | 수정 불가 |
| 25 | **Driving 마진** | 🟡 자동계산 | 수정 불가 |
| 26 | **Top 마진율** | 직접 입력 | 숫자 (%) |
| 27 | **Top 공급가** | 🟡 자동계산 | 수정 불가 |
| 28 | **Top 마진** | 🟡 자동계산 | 수정 불가 |

### 테이블 예시

```
□ │대분류▼│중분류▼│소분류▼│중량│코드 │상품명  │원상품│기준가│로스율│기준중량│개별단가│박스비│자재비│아웃박스│보자기│작업비│택배비│총원가 │S마진율│S공급가│S마진│D마진율│D공급가│D마진│T마진율│T공급가│T마진│
──┼──────┼──────┼──────┼────┼─────┼───────┼─────┼─────┼─────┼──────┼───────┼─────┼─────┼──────┼─────┼─────┼─────┼──────┼──────┼──────┼────┼──────┼──────┼────┼──────┼──────┼────┤
☑ │과일  │사과  │부사  │5kg │A001 │부사5kg │     │50000│5    │10    │5,250  │1000 │500  │300   │200  │1000 │3500 │11,750│20    │14,100│2350│15    │13,513│1763│10    │12,925│1175│
☑ │과일  │배   │신고  │3kg │B001 │신고3kg │     │     │     │      │       │     │     │      │     │     │     │      │      │      │    │      │      │    │      │      │    │
   (빈칸은 옅은 빨간색 배경)
```

---

## 자동 계산 수식 (🟡 노란색 컬럼)

입력값이 변경될 때마다 **실시간으로 자동 계산**되어야 합니다.

### 1) 개별단가
```javascript
개별단가 = (원상품 기준가 × (1 + 로스율/100)) / 원상품 기준중량

// 예시: (50000 × 1.05) / 10 = 5,250원
```

### 2) 상품 총원가
```javascript
상품 총원가 = 개별단가 + 박스비 + 자재비 + 아웃박스 + 보자기 + 작업비 + 택배비

// 예시: 5250 + 1000 + 500 + 300 + 200 + 1000 + 3500 = 11,750원
```

### 3) 등급별 공급가 (Start / Driving / Top 동일 방식)
```javascript
Start 공급가 = Math.round(상품 총원가 × (1 + Start 마진율/100))
Start 마진 = Start 공급가 - 상품 총원가

// 예시: 11750 × 1.20 = 14,100원 / 마진 = 14100 - 11750 = 2,350원

Driving 공급가 = Math.round(상품 총원가 × (1 + Driving 마진율/100))
Driving 마진 = Driving 공급가 - 상품 총원가

Top 공급가 = Math.round(상품 총원가 × (1 + Top 마진율/100))
Top 마진 = Top 공급가 - 상품 총원가
```

---

## UI 스타일 규칙

### 1) 자동계산 컬럼 (노란색)
```css
background-color: #FEF9C3;  /* yellow-100 */
cursor: not-allowed;
/* 클릭해도 편집 불가 */
```

### 2) 빈칸 (값이 없는 셀)
```css
background-color: #FEE2E2;  /* red-100 - 옅은 빨간색 */
```

### 3) 일반 입력 셀
```css
background-color: #FFFFFF;  /* 흰색 */
```

---

## 기능 상세

### 1) 엑셀 업로드 (임시등록)

**업로드 양식 컬럼 (6개)**
| 컬럼명 | 필수 |
|--------|------|
| 대분류 | △ (3개 중 1개 이상) |
| 중분류 | △ |
| 소분류 | △ |
| 중량(수량) | ● 필수 |
| 상품코드 | ● 필수 |
| 상품명 | ● 필수 |

**처리 흐름**
1. 엑셀 파일 드래그 또는 클릭
2. 유효성 검사 (필수값, 상품코드 중복)
3. 성공: 테이블에 새 행 추가 (나머지 컬럼은 빈칸)
4. 실패: 오류 행 표시 (행 번호, 오류 사유)

---

### 2) 기존 상품 검색 (수정용)

**필터 옵션**
- 대분류 / 중분류 / 소분류 (드롭다운)
- 상품코드 (텍스트)
- 상품명 (텍스트)

**동작**
- [검색] 클릭 → 조건에 맞는 기존 상품을 테이블에 불러옴
- [초기화] 클릭 → 필터 초기화, 테이블 비우기
- 불러온 상품 수정 후 전송 가능

---

### 3) 일괄 적용

**적용 가능 항목**
- 상품 원가: 원상품 기준가, 로스율, 원상품 기준중량
- 부대비용: 박스비, 자재비, 아웃박스, 보자기, 작업비, 택배비
- 등급별 마진율: Start 마진율, Driving 마진율, Top 마진율 **(각각 다르게 입력 가능)**

**동작**
1. 테이블에서 여러 행 체크박스 선택
2. 일괄 적용 영역에서 값 입력 (원하는 항목만)
3. [선택한 상품에 일괄 적용] 클릭
4. 선택된 행에 값 적용 → 자동계산 컬럼 업데이트

**주의**: 일괄 적용 시 빈칸으로 둔 항목은 적용하지 않음 (기존 값 유지)

---

### 4) 개별 입력

- 테이블의 각 셀을 클릭하여 직접 입력 가능
- 입력 즉시 해당 행의 자동계산 컬럼 업데이트
- 자동계산 컬럼(노란색)은 클릭해도 편집 불가

---

### 5) 선택 삭제

**동작**
1. 테이블에서 여러 행 체크박스 선택
2. [선택 삭제] 버튼 클릭
3. 확인 모달: "선택한 N개 상품을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."
4. 확인 시 DB에서 **완전 삭제**

---

### 6) 공급 중지 설정

**동작**
1. 테이블에서 여러 행 체크박스 선택
2. [공급 중지 설정] 버튼 클릭
3. 공급 중지 사유 입력 모달:
   ```
   ┌─────────────────────────────────────┐
   │ 공급 중지 설정                       │
   ├─────────────────────────────────────┤
   │ 선택한 N개 상품을 공급 중지합니다.    │
   │                                     │
   │ 중지 사유: [__________________]     │
   │ (예: 시즌 종료, 품질 이슈, 재고 소진) │
   │                                     │
   │              [취소] [공급 중지]      │
   └─────────────────────────────────────┘
   ```
4. 공급 중지 시:
   - 해당 상품의 상태가 'suspended'로 변경
   - **이 목록에서 더 이상 표시 안 됨**
   - **"공급 중지 상품" 탭에서 표시됨** (2차 구현)

---

### 7) "차주 예상공급가 상품으로 전송" 버튼

**위치**: 테이블 하단 중앙

**전송 전 검증**
```javascript
for (각 상품) {
  if (Start공급가 없음 || Driving공급가 없음 || Top공급가 없음) {
    // 🚫 전송 불가
    // 알림: "상품코드 [A001]의 공급가가 없습니다. 마진율을 입력해주세요."
    return;
  }
}
```

**전송 시 동작**
1. 모든 데이터 DB에 저장
2. "차주 예상공급가 상품" 테이블에 반영 (2차 구현 시 연동):
   - **기존 상품** (상품코드 일치): 해당 상품 정보 **업데이트**
   - **신규 상품**: 새로 **추가**
   - **나머지 기존 상품**: **변경 없이 유지**
3. 성공 알림: "N개 상품이 차주 예상공급가로 전송되었습니다."

---

## 데이터 스키마

### product_registrations 테이블
```typescript
{
  id: number;
  status: 'active' | 'suspended';   // 공급중 / 공급중지
  suspendedAt: Date | null;         // 공급중지일
  suspendReason: string | null;     // 공급중지 사유
  
  // 기본 정보
  categoryLarge: string | null;     // 대분류
  categoryMedium: string | null;    // 중분류
  categorySmall: string | null;     // 소분류
  weight: string;                   // 중량(수량)
  productCode: string;              // 상품코드 (unique)
  productName: string;              // 상품명
  
  // 상품 원가
  sourceProduct: string | null;     // 원상품
  sourcePrice: number | null;       // 원상품 기준가
  lossRate: number;                 // 로스율(%) - 기본 0
  sourceWeight: number | null;      // 원상품 기준중량
  unitPrice: number | null;         // 개별단가 (자동계산)
  
  // 부대비용
  boxCost: number;                  // 박스비 - 기본 0
  materialCost: number;             // 자재비 - 기본 0
  outerBoxCost: number;             // 아웃박스 - 기본 0
  wrappingCost: number;             // 보자기 - 기본 0
  laborCost: number;                // 작업비 - 기본 0
  shippingCost: number;             // 택배비 - 기본 0
  totalCost: number | null;         // 상품 총원가 (자동계산)
  
  // Start 등급
  startMarginRate: number | null;   // Start 마진율
  startPrice: number | null;        // Start 공급가 (자동계산)
  startMargin: number | null;       // Start 마진 (자동계산)
  
  // Driving 등급
  drivingMarginRate: number | null; // Driving 마진율
  drivingPrice: number | null;      // Driving 공급가 (자동계산)
  drivingMargin: number | null;     // Driving 마진 (자동계산)
  
  // Top 등급
  topMarginRate: number | null;     // Top 마진율
  topPrice: number | null;          // Top 공급가 (자동계산)
  topMargin: number | null;         // Top 마진 (자동계산)
  
  createdAt: Date;
  updatedAt: Date;
}
```

---

## API 엔드포인트

```
# 카테고리
GET    /api/categories                 # 전체 목록
POST   /api/categories                 # 추가
PUT    /api/categories/:id             # 수정
DELETE /api/categories/:id             # 삭제

# 상품등록 (공급가 계산)
GET    /api/product-registrations              # 목록 조회 (status='active'만)
POST   /api/product-registrations              # 새 상품 추가
POST   /api/product-registrations/upload       # 엑셀 업로드
PUT    /api/product-registrations/:id          # 개별 수정
PUT    /api/product-registrations/bulk         # 일괄 수정
DELETE /api/product-registrations/:id          # 삭제
DELETE /api/product-registrations/bulk         # 선택 삭제
POST   /api/product-registrations/suspend      # 공급 중지
POST   /api/product-registrations/resume       # 공급 재개
POST   /api/product-registrations/send-to-next-week  # 차주로 전송

# 양식 다운로드
GET    /api/product-registrations/template     # 엑셀 양식 다운로드
```

---

## 구현 체크리스트

### 메뉴 구조
- [ ] 사이드바에 "상품관리" 메뉴 추가
- [ ] 5개 하위 메뉴 생성 (카테고리, 상품등록, 차주예상, 현재공급가, 공급중지)
- [ ] 2차 구현 예정 페이지는 "준비 중" 표시

### 카테고리 관리
- [ ] 대분류 / 중분류 / 소분류 탭 구현
- [ ] 카테고리 CRUD (추가, 수정, 삭제)
- [ ] 계층 구조 연결 (중분류→대분류, 소분류→중분류)
- [ ] 삭제 시 하위 분류/상품 체크

### 상품등록 (공급가 계산)
- [ ] 페이지 레이아웃 (4개 섹션)
- [ ] 엑셀 업로드 + 양식 다운로드
- [ ] 기존 상품 검색 필터
- [ ] 일괄 적용 영역 (원가, 부대비용, 등급별 마진율)
- [ ] 테이블 (28개 컬럼)
- [ ] 자동계산 컬럼 (노란색, 수정 불가)
- [ ] 빈칸 표시 (옅은 빨간색)
- [ ] 실시간 자동계산
- [ ] 선택 삭제
- [ ] 공급 중지 설정
- [ ] 전송 전 공급가 검증
- [ ] "차주 예상공급가로 전송" 버튼

---

## 중요 규칙 요약

| 규칙 | 설명 |
|------|------|
| **자동계산 컬럼** | 개별단가, 상품총원가, 각 등급 공급가/마진 → 수정 불가 (노란색) |
| **빈칸 표시** | 값이 없는 셀 → 옅은 빨간색 배경 |
| **전송 조건** | 3개 등급 공급가 모두 있어야 전송 가능 |
| **전송 불가 시** | "상품코드 [XXX]의 공급가가 없습니다" 알림 |
| **저장 시점** | "차주 예상공급가로 전송" 클릭 시 저장 |
| **기존 상품 수정** | 검색 필터로 불러와서 수정 → 전송 시 업데이트 |
| **나머지 상품** | 전송하지 않은 상품은 기존 값 그대로 유지 |
| **선택 삭제** | 확인 모달 후 DB에서 완전 삭제 |
| **공급 중지** | 사유 입력 → "공급 중지 상품" 탭으로 이동, 이 목록에서 안 보임 |
| **공급 재개** | "공급 중지 상품" 탭에서 재개 → 이 목록에 다시 표시됨 |

---

## 다음 단계 (2차 구현 예정)

1. **차주 예상공급가 상품** - 상품등록에서 전송받은 데이터 표시
2. **현재 공급가 상품** - 실제 정산에 사용되는 가격
3. **공급 중지 상품** - 공급 중지된 상품 관리, 재개 기능
