# 비용관리 — 나머지 기능 구현 (후속 작업)

## ⚠️ 최우선 원칙

1. **⛔ 기존 CSS, 글씨체, 폰트, 전역 스타일을 절대 수정하거나 새로 추가하지 마세요.**
2. **기존 회계장부의 다른 탭(회원정산, 공급업체, 매입관리, 매출현황)과 비용관리 탭의 기존 구현(카테고리 DB 연동, 기본 등록/목록)을 깨뜨리지 마세요.**
3. **기존 인증 방식(세션 기반), 라우팅 구조, 기술 스택(React + TanStack Query + shadcn/ui + Drizzle ORM)을 그대로 유지하세요.**
4. 작업은 단계별로 진행하고, 각 단계 완료 후 정상 동작을 확인한 뒤 다음 단계로 넘어가세요.
5. 작업 진행 상황과 결과는 항상 **한글**로 보여주세요.

---

## 📋 현재 상태와 이번 작업 범위

### ✅ 이미 완료된 것
- expenses, expense_keywords, expense_recurring 테이블 생성
- expenseCategories, expenseSubCategories DB 테이블 생성 (하드코딩 → DB 기반)
- 2단계 연동 Select (대분류 → 세부항목)
- 기본 비용 등록/목록/수정/삭제 CRUD
- 초기 키워드 사전 시드 데이터 (69건)

### ⬜ 이번에 구현할 것 (6가지)
1. **항목명 자동완성 (Autocomplete)** — 타이핑 시 드롭다운 + 방향키/Enter 선택 + 자동 분류
2. **키워드 자동 학습** — 수동 분류 선택 시 키워드 사전에 자동 추가
3. **정기 비용 관리** — 매월 고정비 등록 + 월별 자동 생성
4. **스프레드시트 일괄 입력** — 엑셀 스타일 테이블 다중 행 입력
5. **월간 요약 카드 + 차트** — 분류별 도넛차트 + 월별 추이 라인차트
6. **⚙️ 분류 사전 관리 UI** — 키워드 조회/추가/수정/삭제 다이얼로그

---

## 1단계: 항목명 자동완성 (Autocomplete)

이것이 비용관리의 **핵심 기능**입니다. 관리자가 항목명을 타이핑하면 기존 키워드 사전 + 과거 입력 이력에서 자동완성 후보를 보여주고, 선택하면 분류가 자동으로 채워집니다.

### 1-1. 자동완성 API

```
GET /api/admin/accounting/expenses/autocomplete?q=검색어
```

**동작 로직:**

```
1. expense_keywords 테이블에서 keyword가 검색어를 포함(ILIKE '%검색어%')하는 항목 검색
   - categoryId를 JOIN하여 카테고리명, 이모지, 색상 함께 반환

2. expenses 테이블에서 item_name이 검색어를 포함하는 최근 항목 검색 (중복 제거)
   - categoryId를 JOIN하여 카테고리 정보 포함
   - 가장 최근 금액(last_amount)도 함께 반환

3. 두 결과를 합침:
   - 중복 제거 (같은 item_name이면 이력 우선)
   - priority 높은 순 → use_count 높은 순 정렬
   - 최대 10개 반환
```

**응답 형식:**
```json
[
  {
    "item_name": "롯데택배 2월 정산",
    "categoryId": 1,
    "categoryName": "물류/배송비",
    "categoryEmoji": "🚚",
    "categoryColor": "blue",
    "subCategoryId": 2,
    "subCategoryName": "택배비",
    "last_amount": 350000,
    "source": "history"
  },
  {
    "item_name": "롯데택배",
    "categoryId": 1,
    "categoryName": "물류/배송비",
    "categoryEmoji": "🚚",
    "categoryColor": "blue",
    "subCategoryId": null,
    "subCategoryName": null,
    "last_amount": null,
    "source": "keyword"
  }
]
```

### 1-2. 자동 분류 API

```
POST /api/admin/accounting/expenses/classify
```

비용 등록 시 항목명만으로 분류를 추천합니다. 자동완성에서 선택하지 않고 직접 타이핑한 경우에 사용됩니다.

**요청:** `{ item_name: "롯데택배 2월분" }`

**3단계 매칭 로직:**

```
1순위) 거래처명 완전 매칭 (priority >= 50)
  → expense_keywords에서 match_type='exact', priority >= 50인 항목 중
    item_name이 keyword와 정확히 일치하거나 keyword로 시작하는 경우
  → 매칭되면 confidence: "high"

2순위) 키워드 포함 매칭 (priority >= 10)
  → item_name에 포함된 키워드를 expense_keywords에서 검색
  → 가장 priority가 높은 매칭 결과 사용
  → 매칭되면 confidence: "medium"

3순위) 매칭 실패
  → categoryId: null, confidence: "none"
```

**응답:**
```json
{
  "categoryId": 1,
  "categoryName": "물류/배송비",
  "subCategoryId": 2,
  "subCategoryName": "택배비",
  "confidence": "high"
}
```

### 1-3. 프론트엔드 자동완성 컴포넌트

비용 등록 다이얼로그의 항목명 입력 필드를 자동완성 기능이 있는 커스텀 컴포넌트로 교체합니다.

**동작 흐름:**

```
관리자가 "롯" 입력
    ↓ (debounce 300ms 후 GET /autocomplete?q=롯)
드롭다운 표시:
┌──────────────────────────────────────┐
│ 🚚 롯데택배 2월 정산     350,000원    │ ← 이력 (회색 작은 글씨로 금액)
│ 🚚 롯데택배 도서산간                   │ ← 이력
│ 🏢 롯데마트 창고 임대     800,000원    │ ← 이력
│ 🚚 롯데택배              키워드        │ ← 키워드 사전
└──────────────────────────────────────┘
    ↓ (방향키 ▼ 로 "롯데택배 2월 정산" 선택, Enter)
항목명: "롯데택배 2월 정산" 자동 채움
분류: 🚚 물류/배송비 > 택배비 자동 채움
금액: 350,000 참고값 표시 (수정 가능)
    ↓ 커서가 금액 필드로 자동 이동
```

**키보드 조작 (필수):**
- `▲▼` : 드롭다운 항목 이동 (선택된 항목 하이라이트)
- `Enter` : 선택된 항목 확정
- `Esc` : 드롭다운 닫기
- 입력 계속 : 드롭다운 실시간 업데이트

**마우스 조작:**
- 항목 클릭으로 선택
- 드롭다운 외부 클릭 시 닫기

**항목 선택 시 자동 채움:**
1. item_name 필드 → 선택한 항목명
2. 대분류 Select → categoryId 자동 선택
3. 세부항목 Select → subCategoryId 자동 선택 (있는 경우)
4. 금액 필드 → last_amount가 있으면 참고값으로 표시 (관리자가 직접 수정 가능)
5. 커서 → 금액 필드로 자동 이동 (focus)

**새 항목 직접 입력 시 (드롭다운에서 선택하지 않은 경우):**
1. 관리자가 항목명을 타이핑 완료 후 Tab 또는 다른 필드 클릭
2. POST /classify 호출하여 분류 추천
3. confidence가 "high" 또는 "medium" → 분류 자동 채움 + "자동 분류: 🚚 물류/배송비 ✅" 표시
4. confidence가 "none" → 분류 Select가 비어있는 상태 유지 → 관리자가 수동 선택

**연속 등록 모드:**
- "등록" 버튼 옆에 "+ 연속 등록" 버튼 배치
- 클릭 시 비용 등록 후 다이얼로그를 닫지 않고 폼 초기화
- 날짜는 유지, 나머지 필드만 비움
- 빠르게 여러 건 연속 입력 가능

### 1-4. 금액 입력 UX 개선

- 숫자만 입력 가능 (문자 입력 차단)
- 실시간 콤마 포맷 (예: 350000 → 350,000)
- 과세/면세 선택에 따라 공급가/부가세 실시간 자동 계산 표시:
  - 과세: 공급가 = Math.round(amount / 1.1), 부가세 = amount - 공급가
  - 면세: 공급가 = amount, 부가세 = 0

---

## 2단계: 키워드 자동 학습

비용이 등록될 때 키워드를 자동으로 학습하여 다음 입력 시 자동완성에 반영됩니다.

### 2-1. 학습 로직 (비용 등록 API에 추가)

기존 `POST /api/admin/accounting/expenses` API에 아래 학습 로직을 추가합니다:

```
비용 등록: item_name="농협 가마니", categoryId=1 (물류/배송비)
    ↓
1. expense_keywords에서 keyword="농협 가마니"가 있는지 확인
    ↓
2-A. 이미 있으면:
    → use_count += 1
    → last_amount = 등록 금액
    → updated_at 갱신
    ↓
2-B. 없으면:
    → INSERT: keyword="농협 가마니", categoryId=1, subCategoryId=null,
              match_type="contains", priority=50, source="learned",
              use_count=1, last_amount=등록금액
    → 추가로 "농협"이라는 2글자 이상 단어도 확인:
      - "농협"이 expense_keywords에 없으면 INSERT (priority=15, source="learned")
      - 이미 있으면 스킵
    ↓
3. 다음번 "농" 입력 시 → "농협 가마니 🚚물류" 자동완성 표시
```

**단어 추출 규칙:**
- 항목명을 공백으로 분리
- 2글자 이상인 단어만 후보
- 숫자만으로 된 단어는 제외 (날짜, 금액 등)
- "월", "년", "분", "건" 등 일반적인 조사/단위는 제외

---

## 3단계: 정기 비용 관리

매월 고정으로 발생하는 비용(창고 월세, 급여, 서버비 등)을 미리 등록하면 매월 자동으로 비용 내역을 생성합니다.

### 3-1. 정기 비용 API

기존 expense_recurring 테이블을 활용합니다.

```
GET /api/admin/accounting/expenses/recurring
```
- 응답: 등록된 정기 비용 목록 (활성/비활성 모두)
- 각 항목에 카테고리 정보(이모지, 이름, 색상) JOIN

```
POST /api/admin/accounting/expenses/recurring
```
- 요청:
```json
{
  "item_name": "창고 월세",
  "categoryId": 3,
  "subCategoryId": 8,
  "amount": 800000,
  "tax_type": "taxable",
  "payment_method": "자동이체",
  "vendor_name": "OO부동산",
  "day_of_month": 1,
  "cycle": "monthly",
  "memo": "매월 1일 자동이체"
}
```

```
PUT /api/admin/accounting/expenses/recurring/:id
```

```
DELETE /api/admin/accounting/expenses/recurring/:id
```
- 이미 생성된 비용 내역은 삭제하지 않음

```
PATCH /api/admin/accounting/expenses/recurring/:id/toggle
```
- is_active 토글 (활성 ↔ 비활성)

```
POST /api/admin/accounting/expenses/recurring/generate
```
- 요청: `{ month: "2026-02" }`
- 동작:
  1. expense_recurring에서 is_active=true인 항목 조회
  2. cycle="monthly"인 항목은 모두 대상
  3. cycle="yearly"인 항목은 cycle_month가 요청 월과 일치하는 경우만 대상
  4. 대상 항목마다 expenses 테이블에 새 비용 레코드 생성:
     - expense_date = 해당월 + day_of_month (예: 2026-02-01)
     - is_recurring = true
     - recurring_id = 원본 정기비용 ID
  5. **중복 방지**: 이미 해당 월에 같은 recurring_id로 생성된 건이 있으면 스킵
- 응답: `{ generated: 3, skipped: 2, total: 5 }`

### 3-2. 정기 비용 관리 UI

비용관리 탭 상단 버튼 영역에 "🔄 정기비용관리" 버튼을 배치합니다.
클릭 시 다이얼로그:

```
┌───────────────────────────────────────────────────────────┐
│  🔄 정기 비용 관리                                    [✕]   │
├───────────────────────────────────────────────────────────┤
│                                                             │
│  등록된 정기 비용 (5건)                                      │
│                                                             │
│  ┌────┬────────────┬──────────┬──────┬────────┬─────────┐ │
│  │활성 │ 항목명       │ 금액      │ 분류  │ 주기     │ 액션     │ │
│  ├────┼────────────┼──────────┼──────┼────────┼─────────┤ │
│  │ ☑️ │ 창고 월세    │ 800,000  │🏢시설 │ 매월 1일  │ ✏️ 🗑  │ │
│  │ ☑️ │ 직원 급여    │3,500,000 │👤인건 │ 매월 25일 │ ✏️ 🗑  │ │
│  │ ☑️ │ 서버 운영비  │  50,000  │💻IT  │ 매월 1일  │ ✏️ 🗑  │ │
│  │ ☑️ │ 도메인 갱신  │  30,000  │💻IT  │ 매년 3월  │ ✏️ 🗑  │ │
│  │ ☐  │ 4대보험     │ 420,000  │👤인건 │ 매월 10일 │ ✏️ 🗑  │ │
│  └────┴────────────┴──────────┴──────┴────────┴─────────┘ │
│                                                             │
│  [+ 정기 비용 추가]                                          │
│                                                             │
│  ─────────────────────────────────────────────────────     │
│  📅 2026년 2월 정기 비용 현황                                 │
│  생성완료: 3건 (1,250,000원)  |  미생성: 2건 (3,920,000원)    │
│                                                             │
│  [이번 달 정기 비용 일괄 생성]                                 │
└───────────────────────────────────────────────────────────┘
```

**동작:**
- 활성 체크박스: 클릭 시 PATCH /toggle API 호출
- ✏️: 수정 다이얼로그 (등록과 동일한 폼)
- 🗑: 삭제 확인 후 DELETE
- "+ 정기 비용 추가": 등록 다이얼로그 (항목명에 자동완성 적용)
- "이번 달 정기 비용 일괄 생성": POST /generate 호출 → 결과 표시
- 생성완료/미생성 건수는 expenses에서 해당월 + is_recurring=true인 건을 조회하여 계산

---

## 4단계: 스프레드시트 일괄 입력

여러 건의 비용을 한꺼번에 입력할 수 있는 테이블 형태의 입력 UI입니다.

### 4-1. UI

비용관리 탭 상단 버튼 영역에 "📊 스프레드시트" 버튼 배치.
클릭 시 다이얼로그 또는 비용 내역 테이블 위에 인라인으로 스프레드시트 영역 표시:

```
┌──────────┬─────────────────────┬──────────┬──────────┬────────┬────────┐
│  날짜     │  항목명 (자동완성)    │  금액     │ 분류(자동) │ 과세    │ 결제방법 │
├──────────┼─────────────────────┼──────────┼──────────┼────────┼────────┤
│ 02-19    │ 롯데택배 2월분       │ 350,000  │ 🚚물류    │ 과세    │ 계좌이체 │
│ 02-19    │ 직원 급여 2월        │3,500,000 │ 👤인건비  │ 면세    │ 계좌이체 │
│ 02-19    │ 창고 월세            │ 800,000  │ 🏢시설   │ 과세    │ 자동이체 │
│ 02-19    │ 쿠팡 광고비          │ 150,000  │ 📢마케팅  │ 과세    │ 카드    │
│ [+]      │                     │          │          │        │        │
├──────────┴─────────────────────┴──────────┴──────────┴────────┴────────┤
│                                      합계: 4,800,000원  [일괄 등록]     │
└───────────────────────────────────────────────────────────────────────┘
```

### 4-2. 동작

- 각 행의 항목명 셀에서 **자동완성이 동작**해야 함 (1단계에서 만든 Autocomplete 컴포넌트 재사용)
- 항목명 입력/선택 시 분류 자동 채움
- 날짜: 기본값 오늘, 행마다 변경 가능
- 금액: 숫자만 입력, 콤마 포맷
- 과세: 드롭다운 (과세/면세), 기본값 "과세"
- 결제방법: 드롭다운 (계좌이체/카드/현금/자동이체/기타)
- **[+] 행 추가**: 클릭 또는 마지막 행에서 Tab키로 자동 행 추가
- **합계**: 모든 행의 금액 합계 실시간 계산
- **일괄 등록**: POST /expenses/bulk API 호출 → 비어있는 행은 무시, 필수항목(항목명, 금액, 분류) 미입력 행은 빨간 테두리 표시
- 등록 성공 후 스프레드시트 영역 초기화 + 비용 내역 테이블 새로고침

### 4-3. 일괄 등록 API

```
POST /api/admin/accounting/expenses/bulk
```
- 요청:
```json
{
  "items": [
    {
      "expense_date": "2026-02-19",
      "item_name": "롯데택배 2월분",
      "categoryId": 1,
      "subCategoryId": 2,
      "amount": 350000,
      "tax_type": "taxable",
      "payment_method": "계좌이체"
    },
    ...
  ]
}
```
- 동작: 각 항목마다 expenses INSERT + 키워드 학습 (2단계 로직 적용)
- 응답: `{ success: 4, failed: 0 }`

---

## 5단계: 월간 요약 카드 + 차트

### 5-1. 요약/추이 API

```
GET /api/admin/accounting/expenses/summary?month=2026-02
```
- 응답:
```json
{
  "totalExpense": 4800000,
  "byCategory": [
    { "categoryId": 1, "name": "물류/배송비", "emoji": "🚚", "color": "blue", "amount": 350000, "ratio": 7.3 },
    { "categoryId": 2, "name": "인건비", "emoji": "👤", "color": "violet", "amount": 3500000, "ratio": 72.9 },
    ...
  ],
  "prevMonth": {
    "totalExpense": 5200000,
    "changePercent": -7.7
  }
}
```

```
GET /api/admin/accounting/expenses/trend?months=6
```
- 응답:
```json
{
  "months": ["2025-09", "2025-10", "2025-11", "2025-12", "2026-01", "2026-02"],
  "totals": [4500000, 4800000, 5100000, 5500000, 5200000, 4800000],
  "byCategory": {
    "물류/배송비": [300000, 320000, 350000, 380000, 360000, 350000],
    "인건비": [3000000, 3200000, 3400000, 3500000, 3500000, 3500000],
    ...
  }
}
```

### 5-2. 월간 비용 요약 카드 UI

비용 내역 테이블 위에 가로 1줄로 배치:

```
[총비용 4,800,000원 ▼7.7%] [🚚물류 350K] [👤인건 3,500K] [🏢시설 800K] [📢마케팅 150K] [💻IT 50K] [📎사무 0] [🏦금융 0]
```

- 총비용 카드: 강조 스타일 (배경색 진하게), 전월 대비 증감 표시 (▲빨강/▼초록)
- 분류별 카드: 해당 분류 색상 사용, 금액 약식 표시 (K 단위)
- 분류 카드 클릭 시 → 분류 필터 탭 해당 분류 활성화
- 카드가 화면을 넘으면 가로 스크롤 가능

### 5-3. 차트 UI

비용 내역 테이블 아래에 2열로 배치:

**좌측 — 분류별 비율 도넛차트:**
- 대분류 8개 비율
- 중앙에 총비용 표시
- 각 조각 hover 시 분류명 + 금액 + 비율 툴팁

**우측 — 월별 추이 라인차트:**
- 최근 6개월 데이터
- 총비용 라인 (굵은 선)
- 분류별 스택 바 또는 라인 (선택 토글 버튼)

차트는 기존 프로젝트에서 사용 중인 차트 라이브러리(recharts 등)를 그대로 사용하세요. 새로운 차트 라이브러리를 추가하지 마세요.

---

## 6단계: ⚙️ 분류 사전 관리 UI

관리자가 키워드 사전을 직접 조회/추가/수정/삭제할 수 있는 다이얼로그입니다.

### 6-1. API

```
GET /api/admin/accounting/expenses/keywords?category=물류/배송비&search=택배
```
- 쿼리 파라미터: categoryId (분류 필터), search (키워드 검색)
- 응답: 키워드 목록 (priority DESC → use_count DESC)

```
POST /api/admin/accounting/expenses/keywords
```
- 요청: `{ keyword, categoryId, subCategoryId?, match_type? }`
- 검증: 같은 keyword가 이미 존재하면 400 에러
- source: "admin", priority: 50

```
PUT /api/admin/accounting/expenses/keywords/:id
```
- source="system": categoryId, subCategoryId만 변경 가능
- source="admin"/"learned": 모든 필드 변경 가능

```
DELETE /api/admin/accounting/expenses/keywords/:id
```
- source="system": 삭제 불가 (400 에러)
- source="admin"/"learned": 삭제 가능

### 6-2. UI

비용관리 탭 상단 우측에 "⚙️ 분류 사전 관리" 버튼 배치.
클릭 시 다이얼로그:

```
┌──────────────────────────────────────────────────────────────┐
│  ⚙️ 분류 사전 관리                                      [✕]   │
├──────────────────────────────────────────────────────────────┤
│                                                                │
│  [분류 필터] 전체|🚚물류|👤인건|🏢시설|📢마케팅|💻IT|📎사무|🏦금융 │
│                                                                │
│  🔍 [키워드 검색______________]                                 │
│                                                                │
│  ┌──────────┬──────────┬──────────┬──────┬──────┬──────┐     │
│  │  키워드    │  대분류    │  세부항목  │ 출처  │ 사용수 │ 액션  │     │
│  ├──────────┼──────────┼──────────┼──────┼──────┼──────┤     │
│  │ 롯데택배   │ 🚚물류/배송│ 택배비    │ 시스템 │  12   │      │     │
│  │ CJ대한통운 │ 🚚물류/배송│ 택배비    │ 시스템 │   8   │      │     │
│  │ 농협 가마니│ 🚚물류/배송│ 포장재비  │ 학습  │   3   │ ✏️🗑 │     │
│  │ 급여      │ 👤인건비   │ 급여     │ 시스템 │  15   │      │     │
│  │ 네이버블로그│ 📢마케팅   │ 온라인광고 │ 관리자 │   2   │ ✏️🗑 │     │
│  └──────────┴──────────┴──────────┴──────┴──────┴──────┘     │
│                                                                │
│  [+ 키워드 추가]                                                │
│                                                                │
│  ── 범례 ──                                                     │
│  시스템: 기본 제공 (분류 변경만 가능)                               │
│  학습: 비용 등록 시 자동 학습됨 (수정/삭제 가능)                    │
│  관리자: 직접 추가한 키워드 (수정/삭제 가능)                        │
└──────────────────────────────────────────────────────────────┘
```

**키워드 추가/수정 다이얼로그:**

```
┌──────────────────────────────────────┐
│  키워드 추가 (또는 수정)               │
├──────────────────────────────────────┤
│                                        │
│  키워드: [________________]            │
│                                        │
│  대분류: [🚚 물류/배송비  ▼]            │
│  세부항목: [택배비         ▼]           │
│  (대분류 선택 시 세부항목 연동)          │
│                                        │
│  매칭 방식:                             │
│  ◉ 포함 — 키워드가 항목명에 포함되면 매칭 │
│  ○ 완전일치 — 정확히 일치할 때만 매칭    │
│                                        │
│               [취소]  [저장]            │
└──────────────────────────────────────┘
```

**동작:**
- 시스템 키워드 행: 액션 컬럼 비어있음 (수정/삭제 불가), 단 분류 셀을 클릭하면 인라인으로 분류 변경 가능
- 학습/관리자 키워드 행: ✏️ 수정 + 🗑 삭제 버튼 표시
- 삭제 시 확인 다이얼로그 표시
- 검색: 실시간 필터 (debounce 300ms)

---

## 7단계: 엑셀 업로드/다운로드

### 7-1. API

```
GET /api/admin/accounting/expenses/template
```
- 비용 업로드용 엑셀 템플릿 다운로드
- 컬럼: 날짜, 항목명, 금액, 과세구분(과세/면세), 결제방법, 거래처, 메모
- 첫 행에 예시 데이터 포함

```
POST /api/admin/accounting/expenses/upload
```
- multipart/form-data로 엑셀 파일 수신
- 파싱 후 각 행마다 자동 분류 실행
- 응답: 미리보기 데이터 (자동 분류 결과 포함)
```json
{
  "preview": [
    { "row": 1, "item_name": "롯데택배", "amount": 350000, "categoryId": 1, "categoryName": "물류/배송비", "confidence": "high" },
    { "row": 2, "item_name": "기타 잡비", "amount": 50000, "categoryId": null, "categoryName": null, "confidence": "none" }
  ]
}
```

```
POST /api/admin/accounting/expenses/upload/confirm
```
- 미리보기 확인 후 확정 등록
- 분류 실패 항목은 관리자가 수정한 분류로 등록

```
GET /api/admin/accounting/expenses/download?month=2026-02
```
- 해당 월 비용 내역을 엑셀로 다운로드
- 컬럼: 날짜, 분류, 세부항목, 항목명, 금액, 공급가, 부가세, 과세구분, 결제방법, 거래처, 메모

### 7-2. 업로드 UI

"📥 엑셀업로드" 버튼 클릭 시 다이얼로그:

```
┌─────────────────────────────────────────────────┐
│  📥 엑셀 업로드                              [✕]  │
├─────────────────────────────────────────────────┤
│                                                   │
│  📎 템플릿 다운로드                                │
│                                                   │
│  ┌─────────────────────────────────────────┐    │
│  │                                           │    │
│  │    파일을 드래그하거나 클릭하여 업로드       │    │
│  │    (xlsx, xls, csv)                       │    │
│  │                                           │    │
│  └─────────────────────────────────────────┘    │
│                                                   │
│  (업로드 후 미리보기 테이블 표시)                   │
│  ┌──────┬──────────┬────────┬────────┬─────┐   │
│  │ 행번호│ 항목명    │ 금액    │ 분류(자동)│ 상태 │   │
│  ├──────┼──────────┼────────┼────────┼─────┤   │
│  │  1   │ 롯데택배  │350,000 │🚚물류  │ ✅  │   │
│  │  2   │ 기타 잡비 │ 50,000 │ —      │ ⚠️  │   │ ← 분류 실패: 드롭다운 표시
│  └──────┴──────────┴────────┴────────┴─────┘   │
│                                                   │
│  ✅ 자동 분류 1건  ⚠️ 수동 확인 필요 1건            │
│                                                   │
│               [취소]  [전체 등록]                   │
└─────────────────────────────────────────────────┘
```

---

## 검증 체크리스트

### 자동완성 (1단계)
1. ✅ 항목명 1글자 입력 시 자동완성 드롭다운이 나타나는가?
2. ✅ 드롭다운에 분류 이모지 + 항목명 + 금액이 표시되는가?
3. ✅ 방향키(▲▼) + Enter로 항목 선택이 되는가?
4. ✅ 선택 시 분류(대분류+세부항목)가 자동으로 채워지는가?
5. ✅ 선택 시 금액 필드로 커서가 이동하는가?
6. ✅ 새 항목 직접 입력 → Tab → 자동 분류 추천이 동작하는가?
7. ✅ 분류 실패 시 수동 Select가 나타나는가?
8. ✅ 연속 등록 모드가 정상 동작하는가?
9. ✅ 금액 콤마 포맷 + 공급가/부가세 자동 계산이 되는가?

### 키워드 학습 (2단계)
10. ✅ 새 항목으로 비용 등록 시 expense_keywords에 자동 추가되는가?
11. ✅ 다음 입력 시 학습된 키워드가 자동완성에 나타나는가?
12. ✅ 기존 키워드의 use_count가 증가하는가?

### 정기 비용 (3단계)
13. ✅ 정기 비용 등록/수정/삭제가 동작하는가?
14. ✅ 활성/비활성 토글이 동작하는가?
15. ✅ 일괄 생성 시 expenses에 정상 생성되는가?
16. ✅ 중복 생성이 방지되는가?
17. ✅ 생성된 비용에 🔄 정기 표시가 되는가?

### 스프레드시트 (4단계)
18. ✅ 스프레드시트 모드에서 자동완성이 동작하는가?
19. ✅ Tab/Enter로 셀 이동이 되는가?
20. ✅ 행 추가/삭제가 동작하는가?
21. ✅ 합계가 실시간 계산되는가?
22. ✅ 일괄 등록이 정상 동작하는가?

### 차트 (5단계)
23. ✅ 월간 요약 카드에 분류별 금액이 표시되는가?
24. ✅ 전월 대비 증감이 표시되는가?
25. ✅ 도넛차트가 정상 렌더링되는가?
26. ✅ 월별 추이 라인차트가 정상 렌더링되는가?

### 사전 관리 (6단계)
27. ✅ 키워드 목록이 표시되는가?
28. ✅ 키워드 추가/수정/삭제가 동작하는가?
29. ✅ 시스템 키워드는 삭제 불가, 분류 변경만 가능한가?
30. ✅ 분류 필터 + 검색이 동작하는가?

### 엑셀 (7단계)
31. ✅ 템플릿 다운로드가 동작하는가?
32. ✅ 엑셀 업로드 → 미리보기가 표시되는가?
33. ✅ 자동 분류 실패 항목에 수동 선택 UI가 나타나는가?
34. ✅ 전체 등록이 정상 동작하는가?
35. ✅ 월별 다운로드가 동작하는가?

### 기존 기능 보존
36. ✅ 기존 비용 등록/목록/수정/삭제가 정상인가?
37. ✅ 기존 카테고리 DB 연동이 정상인가?
38. ✅ 다른 회계장부 탭이 정상인가?
39. ✅ **기존 CSS, 글씨체가 변경 없이 유지되는가?**

결과를 한글로 보고해 주세요.
