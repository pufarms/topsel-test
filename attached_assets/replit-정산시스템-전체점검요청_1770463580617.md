⚠️ 모든 보고 내용을 반드시 한글(한국어)로 작성하세요.

# 요청: 정산 시스템 전체 구현 현황 보고서 작성

정산 시스템(예치금/포인터)이 제대로 구축되었는지 전체 점검이 필요합니다.
아래 양식에 맞춰 **현재 실제 코드 기준으로** 정확하게 보고해주세요.
추측이 아닌, 실제 코드를 확인한 후 작성해주세요.

---

## 1. DB 스키마 현황

### 1-1. members 테이블 잔액 컬럼

아래 표를 채워주세요:

| 컬럼명 | 데이터 타입 | 기본값 | 설명 |
|--------|-----------|--------|------|
| (실제 예치금 컬럼명) | ? | ? | 예치금 잔액 |
| (실제 포인터 컬럼명) | ? | ? | 포인터 잔액 |

### 1-2. settlement_history 테이블

실제 생성된 컬럼을 모두 나열해주세요:

| 컬럼명 | 데이터 타입 | 필수 여부 | 설명 |
|--------|-----------|----------|------|
| ? | ? | ? | ? |

### 1-3. deposit_history 테이블

| 컬럼명 | 데이터 타입 | 필수 여부 | 설명 |
|--------|-----------|----------|------|
| ? | ? | ? | ? |

### 1-4. pointer_history 테이블

| 컬럼명 | 데이터 타입 | 필수 여부 | 설명 |
|--------|-----------|----------|------|
| ? | ? | ? | ? |

---

## 2. API 목록 및 상세

### 2-1. 관리자 API

각 API에 대해 아래 정보를 작성해주세요:

```
[API 1]
- 경로: POST /api/admin/members/:id/deposit/charge
- 파일 위치: (실제 파일 경로)
- 기능 설명:
- 요청 파라미터: (body에 어떤 값을 받는지)
- 트랜잭션 사용 여부: (예/아니오)
- SELECT FOR UPDATE 사용 여부: (예/아니오)
- deposit_history 기록 여부: (예/아니오)
- 에러 처리: (어떤 경우 에러를 반환하는지)

[API 2]
- 경로: POST /api/admin/members/:id/deposit/refund
- (동일 양식)

[API 3]
- 경로: POST /api/admin/members/:id/pointer/grant
- (동일 양식)

[API 4]
- 경로: GET /api/admin/settlements
- (동일 양식)

[API 5]
- 경로: GET /api/admin/deposit-history
- (동일 양식)

[API 6]
- 경로: GET /api/admin/pointer-history
- (동일 양식)

[API 7]
- 경로: GET /api/admin/members-balance
- (동일 양식)
```

위 목록 외에 정산 관련 관리자 API가 더 있으면 추가로 작성해주세요.

### 2-2. 회원 API

```
[API 1]
- 경로: GET /api/member/my-balance
- 파일 위치:
- 반환 데이터: (어떤 값들을 반환하는지 구체적으로)

[API 2]
- 경로: GET /api/member/my-settlements
- (동일 양식)

[API 3]
- 경로: GET /api/member/my-deposit-history
- (동일 양식)

[API 4]
- 경로: GET /api/member/my-pointer-history
- (동일 양식)
```

위 목록 외에 정산 관련 회원 API가 더 있으면 추가로 작성해주세요.

---

## 3. 잔액 검증 로직 상세

### 3-1. "사용 가능 잔액" 계산

```
- 계산 공식이 구현된 파일 위치:
- 실제 계산 공식: (코드 기준으로 정확하게)
- 진행 중 주문으로 포함하는 상태값: (예: 대기, 상품준비중, 배송준비중 등)
- 진행 중 주문에서 제외하는 상태값: (예: 배송중, 취소 등)
- 주문 금액 계산 시 사용하는 가격: (current_products의 어떤 컬럼?)
- 회원 등급별 가격을 사용하는지: (예/아니오, 사용한다면 어떤 기준?)
```

### 3-2. 엑셀 업로드 시 잔액 검증 (※ 이 사이트는 엑셀 업로드 방식만 사용, 개별 주문 등록 없음)

```
- 검증이 들어있는 파일 위치:
- 기존 검증 흐름에서 몇 번째 위치에 삽입되었는지:
- 정상건 총액 기준으로 검증하는지: (예/아니오)
- 잔액 부족 시 반환하는 데이터: (업로드건수, 정상건수, 총액, 잔액상세, 부족금액 등)
- 잔액 부족 시 부분 등록을 허용하는지: (허용/차단)
```

---

## 4. 배송중 전환 자동 정산 상세

```
- 정산 로직이 들어있는 파일 위치:
- 배송중 전환 API 경로:
- 처리 순서: (단계별로 나열)
  1. ?
  2. ?
  3. ?
  ...

- 차감 우선순위: (포인터 먼저? 예치금 먼저?)
- 회원별 그룹핑 처리 여부: (예/아니오)
- 트랜잭션 사용 여부: (예/아니오)
- SELECT FOR UPDATE 사용 여부: (예/아니오)
- settlement_history 기록 여부: (예/아니오)
- deposit_history 기록 여부: (예/아니오)
- pointer_history 기록 여부: (예/아니오)
- 잔액 부족 시 처리 방식: (해당 회원만 실패? 전체 롤백?)
- 가격 확정 저장 여부: (배송중 전환 시 pending_orders에 확정 가격을 저장하는지)
  - 저장한다면 어떤 컬럼에:
  - 저장하는 가격의 출처: (current_products의 어떤 컬럼?)
```

---

## 5. 프론트엔드 현황

### 5-1. 관리자 정산관리 페이지

```
- 파일 위치:
- URL 경로: /admin/settlements
- 구현된 탭 목록:
- 각 탭별 표시 내용:
- 충전/환급/지급 다이얼로그 구현 여부:
- DateRangeFilter 적용 여부:
```

### 5-2. 회원 대시보드 잔액 표시

```
- 파일 위치:
- 예치금 표시: (실제 DB 연동? 하드코딩 0원?)
- 포인터 표시: (실제 DB 연동? 하드코딩 0원?)
- "예치금 충전하기" 버튼: (있음/없음, 클릭 시 동작)
```

### 5-3. 주문 등록 화면 잔액 배너

```
- 파일 위치:
- 배너 표시 여부: (항상 표시? 부족할 때만? 미구현?)
- 표시 정보: (예치금, 포인터, 진행중주문, 사용가능잔액 등)
- 잔액 상태별 색상 구분: (있음/없음)
```

### 5-4. 잔액 부족 시 알림 UI (엑셀 업로드)

```
- 엑셀 업로드 잔액 부족: (토스트? 다이얼로그? 어떤 정보 표시?)
- 표시되는 상세 정보: (업로드건수, 정상건수, 총액, 잔액현황, 부족금액 등)
- [예치금 충전하기] 버튼 포함 여부:
- 상품 오류 + 잔액 부족 동시 발생 시 처리: (어떻게 표시되는지)
```

### 5-5. 회원 이력 조회 화면

```
- 파일 위치:
- 어떤 탭/페이지에서 접근 가능한지:
- 정산 이력 조회: (구현/미구현)
- 예치금 이력 조회: (구현/미구현)
- 포인터 이력 조회: (구현/미구현)
- 날짜 필터: (적용/미적용)
```

---

## 6. 기존 기능 영향 확인 (⚠️ 매우 중요)

정산 시스템 추가로 인해 기존에 정상 작동하던 기능이 영향을 받았는지 반드시 확인해주세요.
**각 항목을 실제로 코드에서 확인하고**, 정상/문제 여부를 보고해주세요.

### 6-1. 주문 관련

```
- [ ] 엑셀 주문 등록 - 기존 검증 흐름 정상 작동
      확인: 중복파일(SHA-256), 필수필드, 상품존재, 공급중지, 주소검증 순서대로 작동하는지
      확인: 검증 오류 시 기존 오류 다이얼로그 정상 표시되는지
      확인: "정상건만 등록" 기능 정상 작동하는지
      확인: 오류건 엑셀 자동 다운로드 정상 작동하는지

- [ ] 주문 상태 전환 워크플로우 정상 작동
      확인: 대기 → 주문조정 → 상품준비중 → 배송준비중 → 배송중 흐름 유지
      확인: 각 상태별 버튼 및 가시성 제어 정상 작동
      확인: 운송장 전달 기능 정상 작동
      확인: 취소마감 기능 정상 작동

- [ ] 주문 취소 처리 정상 작동
      확인: 회원 취소 시 재고 자동 복원 정상 작동
      확인: 관리자 취소 시 처리 정상 작동
      확인: 취소된 주문이 잔액 계산에서 제외되는지
```

### 6-2. 회원 관련

```
- [ ] 회원 등급별 접근 제어 정상 작동
      확인: PENDING/ASSOCIATE 등급 주문 차단 유지
      확인: START/DRIVING/TOP 등급 주문 가능 유지
      확인: 등급별 가격체계(3-tier) 정상 적용

- [ ] 회원 대시보드 기존 기능 정상 작동
      확인: 기존 탭(주문현황, 상품목록 등) 정상 표시
      확인: 기존 데이터 표시에 오류 없는지
      확인: 사이드바 메뉴 구조 변경 없는지

- [ ] 회원 로그인/인증 정상 작동
      확인: 로그인/로그아웃 정상
      확인: 세션/토큰 처리 정상
```

### 6-3. 관리자 관련

```
- [ ] 관리자 대시보드 기존 기능 정상 작동
      확인: 매출현황, 매입현황 페이지 정상 표시
      확인: 주문관리 페이지 정상 작동
      확인: 회원관리 페이지 정상 작동
      확인: 상품관리 페이지 정상 작동

- [ ] 관리자 사이드바 메뉴 구조
      확인: 기존 메뉴 항목 유지 (누락된 메뉴 없는지)
      확인: 새로 추가된 메뉴(정산관리) 위치 적절한지
      확인: 메뉴 클릭 시 올바른 페이지로 이동하는지
```

### 6-4. 시스템/인프라 관련

```
- [ ] SSE 실시간 알림 정상 작동
      확인: 주문 등록/상태변경 시 실시간 알림 전달
      확인: 관리자/회원 양쪽 모두 수신 정상

- [ ] 엑셀 업로드/다운로드 기존 기능 정상 작동
      확인: 주문등록 양식 다운로드 정상
      확인: 우체국 양식 권한 제어 정상
      확인: 엑셀 파일 파싱 정상

- [ ] API 라우팅 충돌 없음
      확인: 새로 추가된 API 경로가 기존 API 경로와 충돌하지 않는지
      확인: 기존 API 응답 형식이 변경되지 않았는지

- [ ] DB 마이그레이션 안전성
      확인: 새 테이블 추가로 기존 테이블 구조에 영향 없는지
      확인: members 테이블에 컬럼 추가/변경 시 기존 데이터 보존되었는지
      확인: 기존 쿼리들이 정상 작동하는지 (새 컬럼 추가로 인한 오류 없음)
```

### 6-5. UI/스타일 관련

```
- [ ] 기존 페이지 레이아웃 깨짐 없음
      확인: 관리자 페이지들의 테이블, 필터, 버튼 등 기존 UI 유지
      확인: 회원 대시보드 레이아웃 유지
      확인: 반응형(모바일) 표시 정상

- [ ] 기존 컴포넌트 스타일 변경 없음
      확인: 공통 컴포넌트(DateRangeFilter, 테이블, 토스트 등) 스타일 유지
      확인: 새로 추가된 컴포넌트가 기존 스타일과 충돌하지 않는지
```

각 항목에 대해 아래 형식으로 보고해주세요:
- ✅ 확인 완료 (정상)
- ⚠️ 경미한 변경 있음 (상세 내용)
- 🔴 문제 발견 (상세 내용 + 영향 범위)

---

## 📝 보고 시 주의사항

1. **실제 코드를 확인**한 후 작성해주세요. 추측으로 작성하지 마세요.
2. **파일 위치**는 프로젝트 루트 기준 상대 경로로 정확하게 적어주세요.
3. **미구현** 부분이 있으면 솔직하게 "미구현"으로 적어주세요. 괜찮습니다.
4. 위 양식에 없는 정산 관련 구현 사항이 있으면 "7. 기타 구현 사항"으로 추가 보고해주세요.

---

## 📄 보고서 출력 요청

위 내용을 모두 작성한 후, **보고서를 PDF 파일로 생성**하여 다운로드할 수 있도록 해주세요.

- 파일명: `정산시스템-점검보고서.pdf`
- 보고서 작성이 완료되면 PDF 파일을 생성하여 다운로드 링크를 제공해주세요.
- PDF 다운로드 확인 후 해당 파일은 삭제해도 됩니다.
