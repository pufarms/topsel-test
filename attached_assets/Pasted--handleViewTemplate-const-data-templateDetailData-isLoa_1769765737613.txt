// í…œí”Œë¦¿ ìƒì„¸ ì¡°íšŒ ì¿¼ë¦¬ ì¶”ê°€ (handleViewTemplate í•¨ìˆ˜ ìœ„ì—)
const { data: templateDetailData, isLoading: loadingDetail } = useQuery({
  queryKey: ['/api/admin/alimtalk/templates', viewingTemplate?.id, 'detail'],
  queryFn: async () => {
    if (!viewingTemplate) return null;
    const res = await fetch(`/api/admin/alimtalk/templates/${viewingTemplate.id}/detail`);
    if (!res.ok) throw new Error('ì¡°íšŒ ì‹¤íŒ¨');
    return res.json();
  },
  enabled: !!viewingTemplate && viewModalOpen,
});

// í…œí”Œë¦¿ ë‚´ìš© ë³´ê¸° ëª¨ë‹¬ ì „ì²´ êµì²´:
<Dialog open={viewModalOpen} onOpenChange={setViewModalOpen}>
  <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
    <DialogHeader>
      <DialogTitle>{viewingTemplate?.templateName}</DialogTitle>
      <DialogDescription>
        {viewingTemplate?.isAuto ? 'ìë™ ë°œì†¡ ì•Œë¦¼' : 'ìˆ˜ë™ ë°œì†¡ ì•Œë¦¼'}
      </DialogDescription>
    </DialogHeader>

    <div className="space-y-4">
      <div>
        <label className="text-sm font-medium mb-2 block">í…œí”Œë¦¿ ì½”ë“œ</label>
        <div className="p-3 bg-muted rounded-lg font-mono text-sm">
          {viewingTemplate?.templateCode}
        </div>
      </div>

      <div>
        <label className="text-sm font-medium mb-2 block">ì†”ë¼í”¼ í…œí”Œë¦¿ ID</label>
        <div className="p-3 bg-muted rounded-lg font-mono text-sm break-all">
          {viewingTemplate?.templateId}
        </div>
      </div>

      <div>
        <label className="text-sm font-medium mb-2 block">ì„¤ëª…</label>
        <div className="p-3 bg-muted rounded-lg text-sm">
          {viewingTemplate?.description}
        </div>
      </div>

      {/* ë©”ì‹œì§€ ë‚´ìš© (ì†”ë¼í”¼ì—ì„œ ì¡°íšŒ) */}
      <div>
        <label className="text-sm font-medium mb-2 block">
          ğŸ“ ë©”ì‹œì§€ ë‚´ìš©
        </label>
        {loadingDetail ? (
          <div className="p-4 bg-muted rounded-lg text-sm text-muted-foreground">
            ì†”ë¼í”¼ì—ì„œ ì¡°íšŒ ì¤‘...
          </div>
        ) : !templateDetailData ? (
          <div className="p-4 bg-muted rounded-lg text-sm text-red-600">
            ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
          </div>
        ) : (
          <div className="p-4 bg-muted rounded-lg border border-gray-300">
            <pre className="text-sm whitespace-pre-wrap break-words font-sans">
              {templateDetailData.templateContent || 
               templateDetailData.content || 
               'ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'}
            </pre>
          </div>
        )}
      </div>

      {/* í…œí”Œë¦¿ ë³€ìˆ˜ (ìˆëŠ” ê²½ìš°) */}
      {templateDetailData?.templateParameter && templateDetailData.templateParameter.length > 0 && (
        <div>
          <label className="text-sm font-medium mb-2 block">
            ğŸ”¤ ë³€ìˆ˜ ëª©ë¡
          </label>
          <div className="p-3 bg-muted rounded-lg">
            <div className="flex flex-wrap gap-2">
              {templateDetailData.templateParameter.map((param: string, idx: number) => (
                <Badge key={idx} variant="secondary">
                  #{{{param}}}
                </Badge>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* ë²„íŠ¼ ì •ë³´ (ìˆëŠ” ê²½ìš°) */}
      {templateDetailData?.buttons && templateDetailData.buttons.length > 0 && (
        <div>
          <label className="text-sm font-medium mb-2 block">
            ğŸ”˜ ë²„íŠ¼ ì •ë³´
          </label>
          <div className="space-y-2">
            {templateDetailData.buttons.map((button: any, idx: number) => (
              <div key={idx} className="p-3 bg-muted rounded-lg">
                <div className="font-medium text-sm">{button.name}</div>
                {button.linkMo && (
                  <div className="text-muted-foreground text-xs mt-1 break-all">
                    {button.linkMo}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      )}

      <div>
        <label className="text-sm font-medium mb-2 block">ë°œì†¡ í†µê³„</label>
        <div className="grid grid-cols-2 gap-4">
          <div className="p-3 bg-muted rounded-lg">
            <div className="text-sm text-muted-foreground mb-1">ì´ ë°œì†¡</div>
            <div className="text-2xl font-bold">
              {viewingTemplate?.totalSent.toLocaleString()}ê±´
            </div>
          </div>
          <div className="p-3 bg-muted rounded-lg">
            <div className="text-sm text-muted-foreground mb-1">ì´ ë¹„ìš©</div>
            <div className="text-2xl font-bold">
              {viewingTemplate?.totalCost.toLocaleString()}ì›
            </div>
          </div>
        </div>
      </div>

      <div>
        <label className="text-sm font-medium mb-2 block">ìƒíƒœ</label>
        <div className="flex gap-2">
          <Badge variant={viewingTemplate?.isAuto ? 'secondary' : 'default'}>
            {viewingTemplate?.isAuto ? 'ìë™ ë°œì†¡' : 'ìˆ˜ë™ ë°œì†¡'}
          </Badge>
          <Badge variant={viewingTemplate?.isActive ? 'default' : 'secondary'}>
            {viewingTemplate?.isActive ? 'ON' : 'OFF'}
          </Badge>
        </div>
      </div>

      <div className="p-4 border-l-4 border-blue-500 bg-blue-50 rounded">
        <p className="text-sm text-blue-900">
          <strong>ğŸ’¡ ì°¸ê³ :</strong>
          {viewingTemplate?.isAuto
            ? ' ì´ ì•Œë¦¼ì€ ì‹œìŠ¤í…œì—ì„œ ìë™ìœ¼ë¡œ ë°œì†¡ë©ë‹ˆë‹¤.'
            : ' ì´ ì•Œë¦¼ì€ ê´€ë ¨ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°œì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'}
        </p>
      </div>
    </div>

    <DialogFooter>
      <Button onClick={() => setViewModalOpen(false)}>ë‹«ê¸°</Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
