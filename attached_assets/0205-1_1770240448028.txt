[프로젝트: 관리자 선택형 주문 공평 배분 시스템 구현]

주문 관리 시스템에서 재고 부족 시 관리자가 특정 상품을 선택하여 주문 수량을 일괄 조정하는 기능을 구현하려고 한다. 아래의 상황(Scenario), 데이터 구조, 핵심 로직을 반영하여 파이썬(Pandas) 코드를 작성해줘.

1. 기능 개요 (User Story)
상황: 특정 원재료의 재고가 부족하여(- 상태), 관리자가 해당 원재료를 사용하는 상품들 중 **조정이 필요한 상품('주문조정선택' 체크)**을 선택했다.

목표: 선택된 상품들의 주문 건들에 대해, 현재 가용 재고에 맞춰 가장 공평한 비율로 주문 수량을 자동으로 삭감(조정)한다.

기준: 단순히 늦게 주문한 사람(순번)을 취소하는 것이 아니라, 전체 부족 비율만큼 모든 주문자의 수량을 줄여야 한다.

2. 데이터 입력 (Input)
함수나 클래스는 다음의 데이터셋을 입력받는다.

전체 주문 리스트 (df_orders):

컬럼: 주문순번(Unique ID), 회원ID, 상품코드, 주문수량, 주문일시

상품-원재료 매핑 정보 (df_mapping):

컬럼: 상품코드, 원재료명, 필요수량(개당)

참고: 상품 A는 원재료 2개 소모, 상품 B는 원재료 4개 소모 등 소모량이 다름.

현재 원재료 재고 (stock_info):

원재료명: 현재_실재고량 (예: 40개)

관리자 선택 정보 (selected_products):

조정 대상이 될 상품코드 리스트 (예: ['A', 'B'])

3. 핵심 알고리즘 (Fair Adjustment Logic)
반드시 다음 순서대로 계산 로직을 구현할 것.

타겟 필터링: 전체 주문 리스트에서 selected_products에 해당하는 주문 건만 추출한다.

총 필요량 계산: 추출된 주문 건들이 필요로 하는 원재료의 총합을 계산한다.

(예: A상품 10개(개당2) + B상품 5개(개당4) = 20 + 20 = 40)

충족 비율(Ratio) 산출:

Ratio = 현재_실재고량 / 타겟_주문들의_총_필요_원재료량

단, 실재고량이 필요량보다 많으면 Ratio는 1.0 (조정 없음)

개별 주문 조정 (비율 적용):

각 주문 건(주문순번 기준)별로: 조정된_수량 = Math.floor(원래_주문수량 * Ratio)

제약조건 1: 상품은 쪼갤 수 없으므로 소수점은 무조건 내림(Floor) 처리한다.

재고 초과 검증 (Safety Check):

내림 처리를 했더라도, 원재료 소모량이 큰 상품(예: 개당 4개 소모)이 섞여 있을 경우 미세하게 재고가 초과될 수 있는지 검증한다.

만약 조정 후 총 소모량이 실재고를 초과한다면, 주문순번이 가장 늦은(높은) 주문부터 1개씩 추가로 차감하여 재고 범위 내로 맞춘다.

4. 출력 결과 (Output)
조정된 결과가 반영된 '업데이트된 주문 리스트' (데이터프레임 형태)

조정 전후 비교 요약 (조정 전 총 원재료 vs 조정 후 총 원재료)

5. 참고용 예시 (Test Case)
코드를 작성하고 아래 케이스로 검증해줘.

재고: 40개

주문(선택된 상품들):

A회원: 상품1(재료2개 소모) 10개 주문

B회원: 상품1(재료2개 소모) 10개 주문

C회원: 상품1(재료2개 소모) 5개 주문

D회원: 상품2(재료4개 소모) 5개 주문

기대 결과:

필요량 70개 vs 재고 40개 -> 비율 약 0.57

내림 처리 후: A(5개), B(5개), C(2개), D(2개)

최종 원재료 소모: 10 + 10 + 4 + 8 = 32개 (재고 40개 이내 성공)