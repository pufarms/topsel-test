# 매출 통계 사용 설명서

## 1. 개요

매출 통계 페이지(`/admin/stats`)는 관리자가 매출 데이터를 다양한 관점에서 분석할 수 있는 대시보드입니다.

**데이터 기준:**
- **배송중** 상태이며 **가격 확정(priceConfirmed)** 된 주문만 통계에 포함됩니다.
- 가격은 각 회원의 등급별 공급가(supplyPrice)를 기준으로 계산됩니다.
- 모든 날짜/시간은 **KST(한국 표준시, UTC+9)** 기준으로 표시됩니다.

---

## 2. 기간 선택 필터

페이지 상단 탭 옆에 기간 선택 필터가 위치합니다.

### 프리셋 버튼
| 버튼 | 설명 |
|------|------|
| 오늘 | 오늘 하루 (KST 기준) |
| 어제 | 어제 하루 |
| 이번 주 | 이번 주 월요일 ~ 일요일 |
| 지난주 | 지난주 월요일 ~ 일요일 |
| 이번 달 | 이번 달 1일 ~ 말일 |
| 지난달 | 지난달 1일 ~ 말일 |
| 직접 선택 | 캘린더에서 시작일/종료일을 직접 지정 |

- 기간을 변경하면 모든 탭의 데이터가 해당 기간으로 자동 갱신됩니다.
- 선택된 기간은 날짜 배지로 표시됩니다.

---

## 3. 탭 구성

매출 통계는 3개의 탭으로 구성됩니다.

---

### 3-1. 매출 개요 탭

전체 매출 현황을 한눈에 파악할 수 있는 요약 대시보드입니다.

#### 요약 카드 (4개)
| 카드 | 설명 |
|------|------|
| 총 매출액 | 선택 기간 내 전체 매출 합계 |
| 주문 건수 | 선택 기간 내 총 주문 수 |
| 평균 주문금액 | 총 매출액 ÷ 주문 건수 |
| 활성 회원 수 | 해당 기간 내 주문이 있는 회원 수 |

- 각 카드에는 **이전 동일 기간 대비 증감률**이 표시됩니다.
  - 예: 이번 달 선택 시 → 지난달 대비 증감률
- 증가는 초록색, 감소는 빨간색으로 표시됩니다.

#### 매출 추이 차트 (AreaChart)
- 선택 기간에 따라 자동으로 그래프 단위가 조절됩니다:
  - **31일 이하**: 일별 표시
  - **32~90일**: 주별 표시
  - **91일 이상**: 월별 표시

#### 회원별 매출 비중 (PieChart)
- 매출 상위 5개 회원의 매출 비중을 원형 차트로 표시합니다.
- 나머지 회원은 "기타"로 합산됩니다.

#### 상품별 매출 순위 (BarChart)
- 매출 상위 10개 상품을 막대 차트로 표시합니다.

---

### 3-2. 회원별 매출 탭

회원별 매출 현황을 상세하게 분석할 수 있습니다.

#### 회원 목록 테이블
| 열 | 설명 |
|----|------|
| 순위 | 매출액 기준 순위 |
| 회원명 (업체명) | 회원 이름 및 업체명 |
| 거래 기간 | 해당 기간 내 첫 주문일 ~ 마지막 주문일 |
| 주문 건수 | 총 주문 수 |
| 매출액 | 총 매출 합계 (원) |
| 평균 주문금액 | 매출액 ÷ 주문 건수 |
| 매출 비중 | 전체 매출 대비 해당 회원 비율 (%) |

#### 회원명 검색
- 상단 검색창에서 회원명 또는 업체명으로 검색할 수 있습니다.

#### 드릴다운 (상세 보기)
- 테이블의 회원 행을 클릭하면 해당 회원의 상세 분석이 펼쳐집니다:
  - **일별 매출 추이 차트**: 해당 회원의 기간별 매출 변화
  - **상품별 매출 내역**: 해당 회원이 주문한 상품별 매출 상세

---

### 3-3. 상품별 매출 탭

상품별 매출 현황을 분석할 수 있습니다.

#### 필터 옵션
| 필터 | 설명 |
|------|------|
| 대분류 | 상품 대분류 카테고리 선택 |
| 중분류 | 대분류 선택 후 해당하는 중분류 표시 |
| 소분류 | 중분류 선택 후 해당하는 소분류 표시 |
| 공급처 | 전체 / 탑셀러(자체출고) / 외주 업체별 필터 |
| 상품명 검색 | 상품명 또는 상품코드로 검색 |

- 카테고리 필터는 **계단식(Cascading)** 으로 동작합니다:
  - 대분류를 선택하면 해당하는 중분류만 표시
  - 중분류를 선택하면 해당하는 소분류만 표시

#### 상품 목록 테이블
| 열 | 설명 |
|----|------|
| 순위 | 매출액 기준 순위 |
| 상품명 | 상품 이름 |
| 분류 | 대분류 > 중분류 > 소분류 |
| 공급처 | 탑셀러(파란 배지) 또는 외주 업체명(주황 배지) |
| 판매 수량 | 총 판매 수량 |
| 매출액 | 총 매출 합계 (원) |
| 매출 비중 | 전체 매출 대비 해당 상품 비율 (%) |

#### 공급처 표시
- **탑셀러** (자체출고): 파란색 배지
- **외주 업체**: 주황색 배지에 업체명 표시

#### 드릴다운 (상세 보기)
- 테이블의 상품 행을 클릭하면 해당 상품의 상세 분석이 펼쳐집니다:
  - **일별 매출 추이 차트**: 해당 상품의 기간별 매출 변화
  - **회원별 구매 내역**: 해당 상품을 구매한 회원별 매출 상세

---

## 4. 공통 기능

### 금액 표시 형식
- 모든 금액은 한국 원화(₩) 단위로 표시됩니다.
- 1,000원 이상은 천 단위 구분 기호가 적용됩니다.
- 예: `16,920원`, `84,600원`

### 비율 표시
- 매출 비중은 소수점 첫째자리까지 표시됩니다.
- 예: `45.3%`, `100.0%`

### 데이터 갱신
- 기간 선택 변경 시 자동으로 최신 데이터를 조회합니다.
- 필터 변경 시에도 실시간으로 데이터가 갱신됩니다.

---

## 5. 접근 권한

- **ADMIN** 및 **SUPER_ADMIN** 역할만 매출 통계 페이지에 접근할 수 있습니다.
- 일반 회원(seller)은 접근이 불가합니다.

---

## 6. 주의사항

1. 통계 데이터는 **배송중 + 가격확정** 주문만 포함되므로, 아직 배송 전인 주문은 통계에 반영되지 않습니다.
2. 가격 확정은 **배송중 전환 시점**에 이루어지며, 확정 후에는 가격이 변동되지 않습니다.
3. 기간 필터의 날짜는 KST 기준이므로, 주문의 배송중 전환 시점(updatedAt)이 KST로 변환되어 필터링됩니다.
