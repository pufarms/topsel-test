# 게시판 관리 시스템 구성 및 작동 방식

---

## 1. 시스템 개요

게시판 관리 시스템은 **회원(셀러)**이 관리자에게 문의를 등록하고, **관리자**가 해당 문의를 확인하고 답변하는 1:1 문의 시스템입니다.

| 구분 | 설명 |
|------|------|
| 시스템 유형 | 1:1 문의 게시판 (회원 → 관리자 답변) |
| 접근 권한 | 회원: 문의 등록/조회, 관리자: 전체 관리/답변/삭제 |
| 데이터 저장 | PostgreSQL `inquiries` 테이블 |
| 인증 방식 | 세션 기반 (`req.session.userId` + `req.session.userType`) |

---

## 2. 데이터베이스 구조

### inquiries 테이블

| 컬럼명 | 타입 | 필수 | 기본값 | 설명 |
|--------|------|------|--------|------|
| id | serial | O | 자동증가 | 고유 식별자 (Primary Key) |
| member_id | varchar | O | - | 문의 작성 회원 ID |
| member_name | varchar(100) | O | - | 문의 작성 회원명 (업체명 또는 이름) |
| category | varchar(50) | O | "일반문의" | 문의 카테고리 |
| title | varchar(300) | O | - | 문의 제목 |
| content | text | O | - | 문의 내용 |
| status | varchar(20) | O | "대기" | 문의 상태 |
| answer | text | X | null | 관리자 답변 내용 |
| answered_by | varchar(100) | X | null | 답변 작성 관리자 이름 |
| answered_at | timestamp | X | null | 답변 작성 일시 |
| created_at | timestamp | O | now() | 문의 등록 일시 |
| updated_at | timestamp | O | now() | 최종 수정 일시 |

### 상태값 (status)

| 상태 | 설명 |
|------|------|
| 대기 | 아직 답변이 등록되지 않은 상태 |
| 답변완료 | 관리자가 답변을 등록한 상태 |

### 카테고리 (category)

| 카테고리 | 용도 |
|----------|------|
| 일반문의 | 일반적인 질문 및 요청 |
| 상품문의 | 상품 관련 문의 |
| 배송문의 | 배송 관련 문의 |
| 결제문의 | 결제/정산 관련 문의 |
| 기타 | 기타 문의 |

---

## 3. API 엔드포인트

### 3-1. 관리자 API

모든 관리자 API는 `req.session.userId`로 인증하고, 해당 사용자의 role이 `ADMIN` 또는 `SUPER_ADMIN`인지 확인합니다.

#### 문의 목록 조회
```
GET /api/admin/inquiries
```
- **쿼리 파라미터**: `status` (상태 필터), `category` (카테고리 필터)
- **응답**: 전체 문의 목록 배열 (최신순 정렬)
- **필터링**: "전체" 값은 필터 해제, 특정 값 지정 시 해당 조건으로 필터링

#### 문의 상세 조회
```
GET /api/admin/inquiries/:id
```
- **경로 파라미터**: `id` (문의 ID)
- **응답**: 해당 문의의 전체 정보

#### 문의 답변 등록/수정
```
PATCH /api/admin/inquiries/:id/answer
```
- **요청 본문**: `{ answer: "답변 내용" }`
- **동작**: 답변 내용 저장, 상태를 "답변완료"로 변경, 답변자 이름/시간 기록
- **검증**: 답변 내용이 비어있으면 400 에러 반환

#### 문의 삭제
```
DELETE /api/admin/inquiries/:id
```
- **경로 파라미터**: `id` (문의 ID)
- **응답**: `{ message: "삭제 완료" }`

### 3-2. 회원 API

모든 회원 API는 `req.session.userId`와 `req.session.userType === "member"` 조건으로 인증합니다. 회원은 자신의 문의만 조회할 수 있습니다.

#### 내 문의 목록 조회
```
GET /api/member/inquiries
```
- **인증**: 회원 세션 필수
- **응답**: 로그인한 회원의 문의 목록 (최신순 정렬)
- **보안**: `memberId`가 일치하는 문의만 반환

#### 문의 등록
```
POST /api/member/inquiries
```
- **요청 본문**: `{ category: "카테고리", title: "제목", content: "내용" }`
- **동작**: Zod 스키마로 입력값 검증 후 DB에 저장
- **자동 설정**: `memberId`는 세션의 회원 ID, `memberName`은 업체명(companyName) 또는 이름(name)

#### 내 문의 상세 조회
```
GET /api/member/inquiries/:id
```
- **경로 파라미터**: `id` (문의 ID)
- **보안**: 로그인 회원의 ID와 문의의 `memberId`가 일치하는 경우만 반환

---

## 4. 프론트엔드 페이지 구성

### 4-1. 관리자 게시판 관리 페이지

- **경로**: `/admin/board`
- **파일**: `client/src/pages/admin/board-management.tsx`
- **사이드바 메뉴**: "게시판 관리" (ClipboardList 아이콘)

#### 주요 기능

| 기능 | 설명 |
|------|------|
| 문의 목록 테이블 | 번호, 상태, 카테고리, 제목, 작성자, 등록일, 보기 버튼 표시 |
| 상태 필터 | 전체/대기/답변완료 선택 가능 |
| 카테고리 필터 | 전체/일반문의/상품문의/배송문의/결제문의/기타 선택 가능 |
| 텍스트 검색 | 제목, 작성자, 내용에서 키워드 검색 (클라이언트 필터링) |
| 페이지네이션 | 페이지당 15건, 이전/다음 버튼 |
| 상태 카운트 뱃지 | 상단에 "대기 N건", "답변완료 N건" 표시 |
| 상세 다이얼로그 | 문의 클릭 시 상세 내용 + 답변 등록/수정 + 삭제 기능 |

#### 상세 다이얼로그 구성

```
+----------------------------------+
|  문의 상세          [대기] [카테고리]  |
+----------------------------------+
|  작성자: OOO     등록일: YYYY-MM-DD  |
|                                    |
|  [제목]                             |
|  ┌──────────────────────────┐     |
|  │ 문의 내용                      │     |
|  └──────────────────────────┘     |
|                                    |
|  ── 관리자 답변 ──                  |
|  ┌──────────────────────────┐     |
|  │ 답변 입력란                    │     |
|  └──────────────────────────┘     |
|                   [답변 등록]       |
|                                    |
|  ────────────────────────────     |
|                     [문의 삭제]     |
+----------------------------------+
```

- **답변 미등록 상태**: 답변 입력 텍스트영역 + "답변 등록" 버튼
- **답변 완료 상태**: 기존 답변 표시 + 답변자/시간 + 답변 수정 입력란 + "답변 수정" 버튼
- **삭제**: 확인 대화상자 후 삭제 처리

### 4-2. 회원 문의 게시판 탭

- **위치**: 회원 대시보드(`/dashboard`) 내 "문의 게시판" 탭
- **파일**: `client/src/pages/member/inquiry-tab.tsx`
- **대시보드 연동**: 대시보드 문의게시판 카드의 "더보기", "문의하기" 클릭 시 해당 탭으로 이동

#### 주요 기능

| 기능 | 설명 |
|------|------|
| 내 문의 목록 | 상태, 카테고리, 제목, 등록일 표시 |
| 문의 등록 | "문의하기" 버튼 클릭 → 등록 다이얼로그 |
| 문의 상세 조회 | 행 클릭 → 상세 다이얼로그 (답변 확인 가능) |
| 페이지네이션 | 페이지당 10건 |
| 빈 상태 안내 | 문의가 없을 때 안내 메시지 + "문의하기" 버튼 |

#### 문의 등록 다이얼로그 구성

```
+---------------------------+
|  문의 등록                   |
+---------------------------+
|  카테고리: [일반문의 ▼]       |
|                             |
|  제목: [________________]   |
|                             |
|  내용:                       |
|  ┌───────────────────┐     |
|  │                         │     |
|  │                         │     |
|  └───────────────────┘     |
|                             |
|        [취소]  [등록]        |
+---------------------------+
```

- **카테고리 선택**: 일반문의, 상품문의, 배송문의, 결제문의, 기타
- **검증**: 제목과 내용이 모두 입력되어야 등록 버튼 활성화
- **등록 후**: 폼 초기화, 다이얼로그 닫힘, 목록 자동 갱신

#### 문의 상세 다이얼로그 구성

```
+---------------------------+
|  문의 상세    [상태] [카테고리] |
+---------------------------+
|  등록일: YYYY-MM-DD HH:MM   |
|                             |
|  [제목]                      |
|  ┌───────────────────┐     |
|  │ 문의 내용                │     |
|  └───────────────────┘     |
|                             |
|  ── 관리자 답변 ──           |
|  ┌───────────────────┐     |
|  │ 답변 내용                │     |
|  └───────────────────┘     |
|  답변자: OOO   YYYY-MM-DD   |
+---------------------------+
```

- **대기 상태**: "아직 답변이 등록되지 않았습니다" 안내 표시
- **답변완료 상태**: 답변 내용, 답변자, 답변일시 표시

---

## 5. 데이터 흐름

### 5-1. 회원 문의 등록 흐름

```
[회원 대시보드]
    │
    ├── "문의 게시판" 탭 클릭
    │      또는
    ├── 대시보드 문의게시판 카드 → "문의하기" 클릭
    │
    ▼
[문의 등록 다이얼로그]
    │ 카테고리/제목/내용 입력 → "등록" 클릭
    │
    ▼
[POST /api/member/inquiries]
    │ ← 세션에서 memberId, memberName 자동 설정
    │ ← Zod 스키마로 입력값 검증
    │ ← status: "대기" 기본값
    │
    ▼
[DB inquiries 테이블에 저장]
    │
    ▼
[문의 목록 자동 갱신] (queryClient.invalidateQueries)
```

### 5-2. 관리자 답변 흐름

```
[관리자 사이드바] → "게시판 관리" 클릭
    │
    ▼
[게시판 관리 페이지 (/admin/board)]
    │ ← GET /api/admin/inquiries (필터/검색 적용)
    │
    ▼
[문의 목록 테이블]
    │ 행 클릭 또는 "보기" 버튼 클릭
    │
    ▼
[문의 상세 다이얼로그]
    │ 답변 입력 → "답변 등록" 또는 "답변 수정" 클릭
    │
    ▼
[PATCH /api/admin/inquiries/:id/answer]
    │ ← answer 내용 저장
    │ ← status → "답변완료" 변경
    │ ← answeredBy, answeredAt 기록
    │
    ▼
[문의 목록 자동 갱신] (queryClient.invalidateQueries)
```

### 5-3. 관리자 문의 삭제 흐름

```
[문의 상세 다이얼로그]
    │ "문의 삭제" 클릭 → 확인 대화상자
    │
    ▼
[DELETE /api/admin/inquiries/:id]
    │
    ▼
[DB에서 문의 삭제]
    │
    ▼
[다이얼로그 닫힘 + 목록 자동 갱신]
```

---

## 6. 보안 및 접근 제어

| 항목 | 구현 내용 |
|------|----------|
| 관리자 인증 | `req.session.userId` → `storage.getUser()` → `isAdmin(user.role)` 확인 |
| 회원 인증 | `req.session.userId` + `req.session.userType === "member"` → `storage.getMember()` 확인 |
| 데이터 격리 | 회원은 자신의 `memberId`와 일치하는 문의만 조회 가능 |
| 삭제 권한 | 관리자만 문의 삭제 가능 |
| 답변 권한 | 관리자만 답변 등록/수정 가능 |
| DB 무결성 | `memberId`는 notNull 제약조건 적용 |
| 입력 검증 | Zod 스키마를 통한 서버 사이드 입력값 검증 |

---

## 7. 라우팅 및 네비게이션

### 관리자 측

| 항목 | 값 |
|------|-----|
| 라우트 경로 | `/admin/board` |
| 사이드바 메뉴 | "게시판 관리" (ClipboardList 아이콘) |
| 컴포넌트 | `BoardManagement` (`client/src/pages/admin/board-management.tsx`) |

### 회원 측

| 항목 | 값 |
|------|-----|
| 라우트 경로 | `/dashboard` (탭 전환) |
| 사이드바 탭 | "문의 게시판" |
| 컴포넌트 | `MemberInquiryTab` (`client/src/pages/member/inquiry-tab.tsx`) |
| 대시보드 카드 | "문의게시판" 카드에서 "더보기"/"문의하기" 클릭 시 탭 전환 |

---

## 8. 관련 파일 목록

| 파일 경로 | 역할 |
|-----------|------|
| `shared/schema.ts` | DB 스키마 정의 (inquiries 테이블, Zod 스키마, 타입) |
| `server/routes.ts` | API 엔드포인트 (관리자 4개 + 회원 3개) |
| `client/src/pages/admin/board-management.tsx` | 관리자 게시판 관리 페이지 |
| `client/src/pages/member/inquiry-tab.tsx` | 회원 문의 게시판 탭 |
| `client/src/pages/admin-layout.tsx` | 관리자 사이드바 메뉴 등록 |
| `client/src/pages/dashboard.tsx` | 회원 대시보드 탭 연동 |
| `client/src/App.tsx` | 라우트 등록 (`/admin/board`) |

---

## 9. 기술 스택 요약

| 구분 | 기술 |
|------|------|
| 프론트엔드 | React 18 + TypeScript + TanStack Query v5 |
| UI 라이브러리 | shadcn/ui (Card, Badge, Button, Dialog, Select, Input, Textarea) |
| 아이콘 | Lucide React (MessageSquare, Search, Trash2, Send, Eye, Plus 등) |
| 백엔드 | Express 5 + TypeScript |
| ORM | Drizzle ORM |
| 데이터베이스 | PostgreSQL |
| 인증 | express-session 기반 세션 인증 |
| 검증 | Zod + drizzle-zod (createInsertSchema) |

---

*문서 작성일: 2026-02-14*
